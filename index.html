<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.37">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SE-PINN</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="site_libs/quarto-nav/quarto-nav.js"></script>
<link href="./images/favicon.ico" rel="icon">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-29e2c20b02301cfff04dc8050bf30c7e.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-f1f441a184e5560352c6af3bbdfee399.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<style>html{ scroll-behavior: smooth; }</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating">

<div id="quarto-search-results"></div>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active" data-toc-expanded="99">
    <h2 id="toc-title"><strong>CONTENTS</strong></h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><strong>Introduction</strong></a></li>
  <li><a href="#how-se-pinn-is-designed" id="toc-how-se-pinn-is-designed" class="nav-link" data-scroll-target="#how-se-pinn-is-designed"><strong>How SE-PINN is Designed</strong></a>
  <ul>
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background</a></li>
  <li><a href="#property-1-normality" id="toc-property-1-normality" class="nav-link" data-scroll-target="#property-1-normality">Property 1: Normality</a></li>
  <li><a href="#property-2-orthogonality" id="toc-property-2-orthogonality" class="nav-link" data-scroll-target="#property-2-orthogonality">Property 2: Orthogonality</a></li>
  <li><a href="#property-3-symmetry" id="toc-property-3-symmetry" class="nav-link" data-scroll-target="#property-3-symmetry">Property 3: Symmetry</a></li>
  <li><a href="#property-4-consistency" id="toc-property-4-consistency" class="nav-link" data-scroll-target="#property-4-consistency">Property 4: Consistency</a></li>
  </ul></li>
  <li><a href="#how-se-pinn-is-applied" id="toc-how-se-pinn-is-applied" class="nav-link" data-scroll-target="#how-se-pinn-is-applied"><strong>How SE-PINN is Applied</strong></a>
  <ul>
  <li><a href="#step-1-initialize-the-environment" id="toc-step-1-initialize-the-environment" class="nav-link" data-scroll-target="#step-1-initialize-the-environment">Step 1: Initialize the Environment</a></li>
  <li><a href="#step-2-define-the-basepinn-class" id="toc-step-2-define-the-basepinn-class" class="nav-link" data-scroll-target="#step-2-define-the-basepinn-class">Step 2: Define the <code>BasePINN</code> Class</a></li>
  <li><a href="#step-3-define-the-pinn-class" id="toc-step-3-define-the-pinn-class" class="nav-link" data-scroll-target="#step-3-define-the-pinn-class">Step 3: Define the <code>PINN</code> Class</a></li>
  <li><a href="#step-4-define-the-physical-system" id="toc-step-4-define-the-physical-system" class="nav-link" data-scroll-target="#step-4-define-the-physical-system">Step 4: Define the Physical System</a></li>
  <li><a href="#step-5-apply-the-pinn-class" id="toc-step-5-apply-the-pinn-class" class="nav-link" data-scroll-target="#step-5-apply-the-pinn-class">Step 5: Apply the <code>PINN</code> Class</a></li>
  </ul></li>
  <li><a href="#afterword" id="toc-afterword" class="nav-link" data-scroll-target="#afterword"><strong>Afterword</strong></a>
  <ul>
  <li><a href="#github-repository" id="toc-github-repository" class="nav-link" data-scroll-target="#github-repository">GitHub Repository</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">SE-PINN</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><em>Solving the Schrödinger Equation via Physics-Informed Machine Learning</em></p>
<hr>
<section id="introduction" class="level3">
<h3 data-anchor-id="introduction"><strong>Introduction</strong></h3>
<p>SE-PINN is a <strong>physics-informed neural network</strong> in PyTorch that solves the Schrödinger equation of quantum mechanics.</p>
<p>Here, I first explain how SE-PINN is designed and then demonstrate how SE-PINN is applied to the <strong>quantum harmonic oscillator</strong>, which is a model that is used for the interatomic bonding of molecules such as hydrogen iodide and hydrogen fluoride.</p>
<p><img src="./images/no_enforcement_of_symmetry.gif" class="img-fluid"></p>
<hr>
</section>
<section id="how-se-pinn-is-designed" class="level3">
<h3 data-anchor-id="how-se-pinn-is-designed"><strong>How SE-PINN is Designed</strong></h3>
<p>As a physics-informed neural network (PINN), SE-PINN uses principles from physics to reduce the space of solutions in which it searches.</p>
<p>In particular, four physical constraints are used: <strong>normality</strong>, <strong>orthogonality</strong>, <strong>symmetry</strong>, and <strong>consistency</strong>, all of which are explained in the subsequent sections.</p>
<p>Each physical constraint is integrated into SE-PINN through one of two methods: (1) inclusion in the <strong>objective function</strong> of the model (which is used for normality, orthogonality, and consistency) or (2) exact conservation via the <strong>architecture</strong> of the model (which is used for symmetry).</p>
<p>An outstanding feature of SE-PINN is that it is not trained on a set of labeled examples —&nbsp;in other words via supervised learning. In contrast, it learns via <strong>reinforcement learning</strong> (RL) through direct feedback from the SE, which enables it to <strong>adapt</strong> to any quantum-mechanical system.</p>
<p>In fact, it is a minimal example of RL, defined by the Markov Decision Process (MDP) in which the state is the parameters of the model, the action is to compute its predictions based on the parameters, the instantaneous total reward is the negation of the loss, and the policy is to update the parameters to minimize the loss.</p>
<p>In addition, SE-PINN is trained with the <strong>L-BFGS</strong> algorithm, which is a second-order optimizer that approximates the Hessian matrix.</p>
<p>Last, SE-PINN is organized into two classes: <strong><code>BasePINN</code></strong>, which implements the architecture of the model, and <strong><code>PINN</code></strong>, which is a wrapper of <code>BasePINN</code> that includes infrastructure for training and visualization.</p>
<p>The decoupling of the design enables users to define custom classes that change or extend SE-PINN.</p>
<hr>
<section id="background" class="level4">
<h4 data-anchor-id="background">Background</h4>
<section id="physics" class="level5">
<h5 data-anchor-id="physics">(1) Physics</h5>
<p>Quantum mechanics is a theory of physics at the <strong>atomic</strong> scale.</p>
<p>The central equation of quantum mechanics is the <strong>Schrödinger equation</strong>, whose time-independent form is as follows.</p>
<p><span class="math display">\[ - \frac{\hbar^{2}}{2m} \frac{d^2\psi}{dx^2} + V \psi = E \psi \]</span></p>
<ul>
<li><span class="math inline">\(\hbar\)</span> is the reduced Planck constant.</li>
<li><span class="math inline">\(m\)</span> is the mass of the system.</li>
<li><span class="math inline">\(\psi\)</span> is the wavefunction of the system.</li>
<li><span class="math inline">\(x\)</span> is the spatial coordinate (position).</li>
<li><span class="math inline">\(V\)</span> is the potential-energy field of the system.</li>
<li><span class="math inline">\(E\)</span> is the energy of the system.</li>
</ul>
<p><span class="math inline">\(\psi\)</span>, the wavefunction of the system, is the representation of its state.</p>
<p>In classical mechanics, physical quantities such as position and momentum can be measured with infinite precision (in theory). In quantum mechanics, however, the wavefunction is an <em>intermediary</em> between physical quantities and measurements of them.</p>
<p>Heisenberg’s uncertainty principle, for example, indicates that simultaneous measurements of position and momentum are limited in precision.</p>
<!-- <details>
<summary>Terminology</summary>
<p style="margin: 10px;">

---

In quantum mechanics, "eigenstate" is often used to refer to an eigenvector. I prefer "eigenvector" because it is the standard term in mathematics.

In addition, "wave function" is an alternative spelling of "wavefunction". I prefer "wavefunction" because it is less similar to, and therefore less easy to be confused with, "wave equation" — which is a very general equation that is not unique to quantum mechanics.

In other words, _Java_ is to _JavaScript_ as _wavefunction_ is to _wave equation_!

---

</details> -->
</section>
<section id="mathematics" class="level5">
<h5 data-anchor-id="mathematics">(2) Mathematics</h5>
<p>Matrices of complex numbers are central in quantum mechanics.</p>
<p>The <strong>complex conjugate</strong>, <span class="math inline">\(z^{*}\)</span>, of a complex number, <span class="math inline">\(z\)</span>, is the complex number whose real part is identical and whose imaginary part is equal in magnitude and opposite in sign. In other words, the complex conjugate of <span class="math inline">\(a + bi\)</span> is <span class="math inline">\(a - bi\)</span>, and vice versa.</p>
<p>The <strong>modulus</strong>, <span class="math inline">\(|z|\)</span>, of a complex number, <span class="math inline">\(z = a + bi\)</span>, is equal to <span class="math inline">\(\sqrt{a^2 + b^2}\)</span>. Moreover, the square of the modulus is equal to the product of <span class="math inline">\(z\)</span> and its complex conjugate: <span class="math inline">\(|z|^2 = z^{*}z\)</span>.</p>
<p>The <strong>conjugate transpose</strong>, <span class="math inline">\(A^{*}\)</span>, of a complex matrix, <span class="math inline">\(A\)</span>, is its transpose where each element is instead its complex conjugate.</p>
<p>A <strong>Hermitian</strong> matrix is a matrix that is equal to its conjugate transpose. In other words, <span class="math inline">\(A = A^{*}\)</span>.</p>
<p>Extension of modulus to complex vectors / matrices.</p>
<hr>
</section>
</section>
<section id="property-1-normality" class="level4">
<h4 data-anchor-id="property-1-normality">Property 1: Normality</h4>
<p><strong>Physics</strong>: In the Copenhagen interpretation of quantum mechanics, the wavefunction of a physical system determines the <strong>probability</strong> that the system is observed to be in a particular state. In particular, the squared modulus of the wavefunction, <span class="math inline">\(|\psi(x)|^{2}\)</span>, is a probability density function.</p>
<p><span class="math display">\[\int_{a}^{b} |\psi(x)|^{2} \,dx = \Pr[a \leq X \leq b]\]</span></p>
<p><strong>Mathematics</strong>: The integral of such a quantity over <strong>all states</strong> must be equal to 1 due to the law of total probability. Furthermore, for systems that are bound to a potential and therefore localized in space, the <strong>limit</strong> of the wavefunction at infinity must be equal to 0.</p>
<!-- (In particular, such is true for the squared modulus of the wavefunction, but.) -->
<p><span class="math display">\[\int_{-\infty}^{+\infty} |\psi(x)|^{2} \,dx = 1\]</span></p>
<p><span class="math display">\[ \lim_{x\to\pm\infty} \psi(x) = 0 \]</span></p>
<p><strong>SE-PINN</strong>: The <strong>objective function</strong> of the model includes both a normality-based component that is adjusted for discretization (<code>dx</code>) and a boundary-based component.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>normality_loss <span class="op">=</span> (torch.<span class="bu">sum</span>(wf <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span> <span class="op">/</span> <span class="va">self</span>.dx) <span class="op">**</span> <span class="dv">2</span></span></code></pre></div>
<details>
<summary>
Derivation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><span class="math display">\[\begin{equation}
\begin{split}
\int_{-\infty}^{+\infty} |\psi(x)|^{2} \,dx &amp; = 1 \\[1em]
\sum_{i} |\psi(x_{i})|^{2} \,\Delta x &amp; = 1 \\[1em]
\sum_{i} |\psi(x_{i})|^{2} &amp; = \frac{1}{\Delta x} \\[1em]
\sum_{i} |\psi(x_{i})|^{2} - \frac{1}{\Delta x} &amp; = 0 \\[1em]
\left( \sum_{i} |\psi(x_{i})|^{2} - \frac{1}{\Delta x} \right)^{2} &amp; = 0
\end{split}
\end{equation}\]</span></p>
<hr>
<p></p>
</details>
<details>
<summary>
Explanation
</summary>
<p style="margin: 10px;">
</p><hr>
<p>The final squaring is used so that positive values and negative values are additive rather than subtractive and so that high values are penalized more. But another function such as the absolute value can be used as well.</p>
<p>Moreover, such a loss discourages trivial solutions (wavefunctions of 0) since they result in non-zero loss, <span class="math inline">\(\left(\frac{1}{\Delta x}\right)^{2}\)</span>, while non-trivial solutions result in zero loss.</p>
<hr>
<p></p>
</details>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>boundary_loss <span class="op">=</span> wf[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> wf[<span class="op">-</span><span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span></span></code></pre></div>
<details>
<summary>
Explanation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><code>wf[0]</code> is the value at the left end of the wavefunction, and <code>wf[-1]</code> is the value at the right end of the wavefunction.</p>
<p>The squaring of each end is used so that (1) positive values and negative values are additive rather than subtractive and (2) high values are penalized more.</p>
<!-- In addition, the factor of 0.5 is a hyperparameter to balance `boundary_loss` with the other components of the loss. -->
<p></p>
</details>
<hr>
</section>
<section id="property-2-orthogonality" class="level4">
<h4 data-anchor-id="property-2-orthogonality">Property 2: Orthogonality</h4>
<p><strong>Physics</strong>: Measurements of a physical quantity, such as energy, are <strong>real</strong> numbers rather than complex numbers.</p>
<p><span class="math display">\[E \in \mathbb{R}\]</span></p>
<p><strong>Mathematics</strong>: Measurements of a physical quantity are <strong>eigenvalues</strong> of a complex matrix that represents the physical quantity. Since these eigenvalues are real, the matrix must be <strong>Hermitian</strong>. Thus, as a property of Hermitian matrices, the set of all eigenvectors of such a matrix must be an <strong>orthogonal</strong> set; in other words, every eigenvector must be orthogonal to every other eigenvector.</p>
<p><span class="math display">\[ \psi_{i}(x)^{*} \psi_{j}(x) = 0, \ i \neq j\]</span></p>
<details>
<summary>
Proof
</summary>
<p style="margin: 10px;">
</p><hr>
<p>The proof follows from the fact that the Hamiltonian matrix, <span class="math inline">\(H\)</span>, is Hermitian (<span class="math inline">\(H = H^{*}\)</span>), that the indices of the eigenvectors are distinct (<span class="math inline">\(i \neq j\)</span>), and that the eigenvalues of such eigenvectors are non-degenerate (<span class="math inline">\(E_{i} \neq E_{j}\)</span>).</p>
<p><span class="math display">\[\begin{equation}
\begin{split}

\psi_{i}(x)^{*} \hat{H}^{*} \psi_{j}(x) &amp; = \psi_{i}(x)^{*} \hat{H}^{*} \psi_{j}(x) \\[1em]

\left(\hat{H} \psi_{i}(x)\right)^{*} \psi_{j}(x) &amp; = \psi_{i}(x)^{*} \left(\hat{H} \psi_{j}(x)\right) \\[1em]

E_{i} \left(\psi_{i}(x)^{*} \psi_{j}(x)\right) &amp; = E_{j} \left(\psi_{i}(x)^{*} \psi_{j}(x)\right) \\[1em]

E_{i} \left(\psi_{i}(x)^{*} \psi_{j}(x)\right) - E_{j} \left(\psi_{i}(x)^{*} \psi_{j}(x)\right) &amp; = 0 \\[1em]

(E_{i} - E_{j}) \left(\psi_{i}(x)^{*} \psi_{j}(x)\right) &amp; = 0 \\[1em]

\psi_{i}(x)^{*} \psi_{j}(x) &amp; = 0

\end{split}
\end{equation}\]</span></p>
<hr>
<p></p>
</details>
<p><strong>SE-PINN</strong>: The <strong>objective function</strong> of the model includes an orthogonality-based component.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>orthogonality_loss <span class="op">=</span> torch.dot(wf, <span class="va">self</span>.basis_sum) <span class="op">**</span> <span class="dv">2</span></span></code></pre></div>
<details>
<summary>
Explanation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><code>self.basis_sum</code> is the sum of all other eigenvectors so far learned by SE-PINN, and it is therefore a linear combination of these eigenvectors. As a result, any vector that is orthogonal to <code>self.basis_sum</code> is orthogonal to each of the other eigenvectors. The great advantage is that computing the inner product of the current wavefunction and <code>self.basis_sum</code> is much more <strong>efficient</strong> than computing it for each pair.</p>
<p>The final squaring is used so that positive values and negative values are additive rather than subtractive and so that high values are penalized more. But another function such as the absolute value can be used as well.</p>
<p></p>
</details>
<hr>
</section>
<section id="property-3-symmetry" class="level4">
<h4 data-anchor-id="property-3-symmetry">Property 3: Symmetry</h4>
<p><strong>Physics</strong>: If the quantum-mechanical potential of a system is even, in other words symmetric about the y-axis such that <span class="math inline">\(V(x) = V(-x)\)</span>, then the eigenvectors of energy that are bound to the potential are also <strong>symmetric</strong>, either even or odd.</p>
<details>
<summary>
Proof
</summary>
<p style="margin: 10px;">
</p><hr>
<p>The proof follows from the Schrödinger equation.</p>
<p><span class="math display">\[\begin{equation}
\begin{split}

- \frac{\hbar^{2}}{2m} \frac{d^2\psi(x)}{dx^2} + V(x) \psi(x) &amp; = E \psi(x) \\[1em]
- \frac{\hbar^{2}}{2m} \frac{d^2\psi(-x)}{d(-x)^2} + V(-x) \psi(-x) &amp; = E \psi(-x) \\[1em]
- \frac{\hbar^{2}}{2m} \frac{d^2\psi(-x)}{dx^2} + V(x) \psi(-x) &amp; = E \psi(-x)

\end{split}
\end{equation}\]</span></p>
<p>Thus, both <span class="math inline">\(\psi(x)\)</span> and <span class="math inline">\(\psi(-x)\)</span> are solutions of the same energy, <span class="math inline">\(E\)</span>.</p>
<p>However, since eigenvectors that are bound to the potential are non-degenerate, <span class="math inline">\(\psi(x)\)</span> and <span class="math inline">\(\psi(-x)\)</span> correspond to the <strong>same</strong> solution.</p>
<p>Moreover, since the Schrödinger equation is a <strong>linear</strong> equation, <span class="math inline">\(\psi(x) = a \psi(-x)\)</span>, and both <span class="math inline">\(a = 1\)</span> and <span class="math inline">\(a = -1\)</span> are valid.</p>
<p>As a result, <span class="math inline">\(\psi(x) = \psi(-x)\)</span> is an even solution, <span class="math inline">\(\psi(x) = -\psi(-x)\)</span> is an odd solution, and every solution is either even or odd.</p>
<hr>
<p></p>
</details>
<p><strong>Mathematics</strong>: Any function whose domain is symmetric about the origin can be expressed as the sum of an <strong>even</strong> function and an <strong>odd</strong> function, and therefore these components can be separated.</p>
<!-- In addition, such a decomposition is unique. -->
<!-- Why not just reflect an arbitrary side about x = 0 or y = x? -->
<p><span class="math display">\[ \psi_{\text{E}}(x) = \frac{1}{2} (\psi(x) + \psi(-x)) \]</span></p>
<p><span class="math display">\[ \psi_{\text{O}}(x) = \frac{1}{2} (\psi(x) - \psi(-x)) \]</span></p>
<p><span class="math display">\[ \psi(x) = \psi_{\text{E}}(x) + \psi_{\text{O}}(x) \]</span></p>
<details>
<summary>
Proof
</summary>
<p style="margin: 10px;">
</p><hr>
<p>As indicated above, the domain of <span class="math inline">\(\psi(x)\)</span> must be symmetric about the origin for such a decomposition to exist. Otherwise <span class="math inline">\(\psi(-x)\)</span> is not defined for all values of <span class="math inline">\(x\)</span> in the domain!</p>
<ol type="1">
<li><span class="math inline">\(\psi_{\text{E}}(x) + \psi_{\text{O}}(x)\)</span> is a decomposition of <span class="math inline">\(\psi(x)\)</span>.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi_{\text{E}}(x) + \psi_{\text{O}}(x) &amp; = \frac{1}{2} (\psi(x) + \psi(-x)) + \frac{1}{2} (\psi(x) - \psi(-x)) \\[1em]
&amp; = \frac{1}{2} \psi(x) + \frac{1}{2} \psi(-x) + \frac{1}{2} \psi(x) - \frac{1}{2} \psi(-x) \\[1em]
&amp; = \psi(x)
\end{split}
\end{equation}\]</span></p>
<ol start="2" type="1">
<li><span class="math inline">\(\psi_{\text{E}}(x)\)</span> is even.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi_{\text{E}}(x) &amp; = \frac{1}{2} (\psi(x) + \psi(-x)) \\[1em]
&amp; = \frac{1}{2} (\psi(-x) + \psi(x)) \\[1em]
&amp; = \psi_{\text{E}}(-x)
\end{split}
\end{equation}\]</span></p>
<ol start="3" type="1">
<li><span class="math inline">\(\psi_{\text{O}}(x)\)</span> is odd.</li>
</ol>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi_{\text{O}}(x) &amp; = \frac{1}{2} (\psi(x) - \psi(-x)) \\[1em]
&amp; = -\frac{1}{2} (\psi(-x) - \psi(x)) \\[1em]
&amp; = -\psi_{\text{O}}(-x)
\end{split}
\end{equation}\]</span></p>
<hr>
<p></p>
</details>
<p><strong>SE-PINN</strong>: A custom architectural layer that can enforce such a separation — a <strong>hub layer</strong> — is used as the final layer of the model.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>predicted_wf <span class="op">=</span> <span class="va">self</span>.even <span class="op">*</span> <span class="fl">0.5</span> <span class="op">*</span> (torch.mm(<span class="va">self</span>.weights, H_plus) <span class="op">+</span> <span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.bias)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>             <span class="op">+</span> <span class="va">self</span>.odd <span class="op">*</span> <span class="fl">0.5</span> <span class="op">*</span> torch.mm(<span class="va">self</span>.weights, H_minus)</span></code></pre></div>
<details>
<summary>
Derivation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><span class="math display">\[\psi(x) = \sum_{i = 1}^{N} w_{i} h_{i}(x) + b\]</span></p>
<hr>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi_{\text{E}}(x) &amp; = \frac{1}{2} (\psi(x) + \psi(-x)) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} h_{i}(x) + b + \sum_{i = 1}^{N} w_{i} h_{i}(-x) + b\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} (w_{i} h_{i}(x) + w_{i} h_{i}(-x)) + 2 b\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} (h_{i}(x) + h_{i}(-x)) + 2 b\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} H_{i}^{+}(x) + 2 b\right)
\end{split}
\end{equation}\]</span></p>
<hr>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi_{\text{O}}(x) &amp; = \frac{1}{2} (\psi(x) - \psi(-x)) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} h_{i}(x) + b - \left(\sum_{i = 1}^{N} w_{i} h_{i}(-x) + b\right)\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} (w_{i} h_{i}(x) - w_{i} h_{i}(-x))\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} (h_{i}(x) - h_{i}(-x))\right) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} H_{i}^{-}(x)\right)
\end{split}
\end{equation}\]</span></p>
<hr>
<p><span class="math display">\[\begin{equation}
\begin{split}
\psi(x) &amp; = \psi_{\text{E}}(x) + \psi_{\text{O}}(x) \\[1em]

&amp; = \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} H_{i}^{+}(x) + 2 b\right) + \frac{1}{2} \left(\sum_{i = 1}^{N} w_{i} H_{i}^{-}(x)\right)
\end{split}
\end{equation}\]</span></p>
<hr>
<p></p>
</details>
<details>
<summary>
Explanation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><code>self.even</code> and <code>self.odd</code> can be configured as 0 or 1 to enforce a particular symmetry.</p>
<p>Since SE-PINN is a <strong>neural network</strong>, <span class="math inline">\(\psi(x) = \sum_{i = 1}^{N} w_{i} h_{i}(x) + b\)</span>, where <span class="math inline">\(w_{i}\)</span> is a weight of the final hidden layer, <span class="math inline">\(h_{i}(x)\)</span> is an input from the previous layer, and <span class="math inline">\(b\)</span> is the bias of the output layer (a single node).</p>
<p><code>H_plus</code> and <code>H_minus</code> are used to <strong>abbreviate</strong> the notation.</p>
<p><code>H_plus</code> is equal to <span class="math inline">\(h(x) + h(-x)\)</span>, and <code>H_minus</code> is equal to <span class="math inline">\(h(x) - h(-x)\)</span>.</p>
<p></p>
</details>
<hr>
</section>
<section id="property-4-consistency" class="level4">
<h4 data-anchor-id="property-4-consistency">Property 4: Consistency</h4>
<p><strong>Physics</strong>: Any state of a quantum-mechanical system must satisfy the Schrödinger equation.</p>
<p><strong>Mathematics</strong>: The time-independent Schrödinger equation is a differential equation, whose solutions, <span class="math inline">\(\psi\)</span>, are eigenvectors of the Hamiltonian matrix, <span class="math inline">\(\hat{H} = - \frac{\hbar^{2}}{2m} \frac{d^2}{dx^2} + V\)</span>.</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
\hat{H} \psi &amp; = E \psi \\[1em]
- \frac{\hbar^{2}}{2m} \frac{d^2\psi}{dx^2} + V \psi &amp; = E \psi
\end{split}
\end{equation}\]</span></p>
<p><strong>SE-PINN</strong>: The <strong>objective function</strong> of the model includes a component that quantifies how well it satisfies the Schrödinger equation via the mean squared error (MSE).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>SE_loss <span class="op">=</span> torch.mean((<span class="op">-</span>hbar <span class="op">/</span> (<span class="dv">2</span> <span class="op">*</span> <span class="va">self</span>.m) <span class="op">*</span> dd <span class="op">+</span> <span class="va">self</span>.V <span class="op">*</span> wf <span class="op">-</span> energy <span class="op">*</span> wf) <span class="op">**</span> <span class="dv">2</span>)</span></code></pre></div>
<details>
<summary>
Derivation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><span class="math inline">\(\hbar^{2}\)</span> and <span class="math inline">\(m\)</span> can be omitted for simplicity and absorbed by <span class="math inline">\(E\)</span>.</p>
<p><span class="math display">\[\begin{equation}
\begin{split}
- \frac{1}{2} \frac{d^2\psi}{dx^2} + V \psi &amp; = E \psi \\[1em]
- \frac{1}{2} \frac{d^2\psi}{dx^2} + V \psi - E \psi &amp; = 0 \\[1em]
\end{split}
\end{equation}\]</span></p>
<hr>
<p></p>
</details>
<details>
<summary>
Explanation
</summary>
<p style="margin: 10px;">
</p><hr>
<p><code>dd</code> is the second derivative of the wavefunction with respect to position and is of the same shape as the wavefunction. The potential, <code>self.V</code>, is a scalar-valued function, and <code>energy</code> is a scalar, so <code>self.V * wf</code> and <code>energy * wf</code> are element-wise products.</p>
<p></p>
</details>
<hr>
</section>
</section>
<section id="how-se-pinn-is-applied" class="level3">
<h3 data-anchor-id="how-se-pinn-is-applied"><strong>How SE-PINN is Applied</strong></h3>
<section id="step-1-initialize-the-environment" class="level4">
<h4 data-anchor-id="step-1-initialize-the-environment">Step 1: Initialize the Environment</h4>
<div class="sourceCode" id="cb6"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="op">%</span>config InlineBackend.print_figure_kwargs <span class="op">=</span> {<span class="st">'bbox_inches'</span>: <span class="va">None</span>}</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> random</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> sys</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> IPython</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.animation <span class="im">import</span> FuncAnimation, PillowWriter</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib_inline</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> rich.progress <span class="im">import</span> (</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    BarColumn,</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    Progress,</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    TaskProgressColumn,</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    TextColumn,</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    TimeRemainingColumn,</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    track</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.linalg <span class="im">import</span> eigh_tridiagonal</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> torch.nn <span class="im">as</span> nn</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>matplotlib_inline.backend_inline.set_matplotlib_formats(<span class="st">'retina'</span>)</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.figsize'</span>] <span class="op">=</span> (<span class="fl">6.4</span>, <span class="fl">4.8</span>)</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a><span class="co"># Environment Variables</span></span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="st">'google.colab'</span> <span class="kw">not</span> <span class="kw">in</span> sys.modules:</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>export LC_ALL<span class="op">=</span><span class="st">'en_US.UTF-8'</span></span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>export LD_LIBRARY_PATH<span class="op">=</span><span class="st">'/usr/lib64-nvidia'</span></span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    <span class="op">!</span>export LIBRARY_PATH<span class="op">=</span><span class="st">'/usr/local/cuda/lib64/stubs'</span></span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a><span class="co"># Optional Hardware Acceleration</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a><span class="co"># Use Runtime &gt; Change runtime type &gt; T4 GPU on Google Colab.</span></span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> torch.cuda.is_available():</span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>    torch.cuda.init()</span>
<span id="cb6-37"><a href="#cb6-37" aria-hidden="true" tabindex="-1"></a>    torch.cuda.is_initialized()</span>
<span id="cb6-38"><a href="#cb6-38" aria-hidden="true" tabindex="-1"></a>    torch.set_default_tensor_type(<span class="st">'torch.cuda.FloatTensor'</span>)</span>
<span id="cb6-39"><a href="#cb6-39" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> <span class="st">'cuda'</span></span>
<span id="cb6-40"><a href="#cb6-40" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span>:</span>
<span id="cb6-41"><a href="#cb6-41" aria-hidden="true" tabindex="-1"></a>    device <span class="op">=</span> <span class="st">'cpu'</span></span>
<span id="cb6-42"><a href="#cb6-42" aria-hidden="true" tabindex="-1"></a>device <span class="op">=</span> torch.device(device)</span>
<span id="cb6-43"><a href="#cb6-43" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Using </span><span class="sc">{</span>device<span class="sc">}</span><span class="ss">.'</span>)</span>
<span id="cb6-44"><a href="#cb6-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-45"><a href="#cb6-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Settings for Reproducibility</span></span>
<span id="cb6-46"><a href="#cb6-46" aria-hidden="true" tabindex="-1"></a>torch.manual_seed(<span class="dv">0</span>)</span>
<span id="cb6-47"><a href="#cb6-47" aria-hidden="true" tabindex="-1"></a>torch.backends.cudnn.benchmark <span class="op">=</span> <span class="va">False</span></span>
<span id="cb6-48"><a href="#cb6-48" aria-hidden="true" tabindex="-1"></a>torch.use_deterministic_algorithms(<span class="va">True</span>)</span>
<span id="cb6-49"><a href="#cb6-49" aria-hidden="true" tabindex="-1"></a>torch.utils.deterministic.fill_uninitialized_memory <span class="op">=</span> <span class="va">True</span></span>
<span id="cb6-50"><a href="#cb6-50" aria-hidden="true" tabindex="-1"></a>os.environ[<span class="st">'CUBLAS_WORKSPACE_CONFIG'</span>]<span class="op">=</span><span class="st">':4096:2'</span> <span class="co"># cuBLAS</span></span>
<span id="cb6-51"><a href="#cb6-51" aria-hidden="true" tabindex="-1"></a>np.random.seed(<span class="dv">0</span>)</span>
<span id="cb6-52"><a href="#cb6-52" aria-hidden="true" tabindex="-1"></a>random.seed(<span class="dv">0</span>)</span>
<span id="cb6-53"><a href="#cb6-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-54"><a href="#cb6-54" aria-hidden="true" tabindex="-1"></a><span class="co"># Convenience Function for Plotting with PyTorch Tensors</span></span>
<span id="cb6-55"><a href="#cb6-55" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> to_plot(x): <span class="cf">return</span> x.detach().cpu().numpy()</span></code></pre></div>
<hr>
</section>
<section id="step-2-define-the-basepinn-class" class="level4">
<h4 data-anchor-id="step-2-define-the-basepinn-class">Step 2: Define the <code>BasePINN</code> Class</h4>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> BasePINN(nn.Module):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">    A base class for a physics-informed neural network (PINN) for</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">    solving the Schrodinger equation.</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="co">    x0 : float</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">        The spatial position of the leftmost point of the</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">        quantum-mechanical potential.</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    xN : float</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">        The spatial position of the rightmost point of the</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">        quantum-mechanical potential.</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">    dx : float</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="co">        The uniform spatial Euclidean distance between adjacent points.</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="co">    N : int</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a><span class="co">        The count of points of the quantum-mechanical potential.</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a><span class="co">    activation : builtin_function_or_method</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a><span class="co">        The activation function.</span></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a><span class="co">    sym : int</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a><span class="co">        Whether to enforce even symmetry (1) or odd symmetry (-1) or not</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="co">        to enforce symmetry (0).</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a><span class="co">    Methods</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="co">    swap_symmetry</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a><span class="co">        Swap the symmetry of the prediction of the model between even</span></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a><span class="co">        symmetry and odd symmetry.</span></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a><span class="co">    forward(x)</span></span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a><span class="co">        Forward pass.</span></span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, grid_params, activation, sym<span class="op">=</span><span class="dv">0</span>):</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(BasePINN, <span class="va">self</span>).<span class="fu">__init__</span>()</span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x0, <span class="va">self</span>.xN, <span class="va">self</span>.dx, <span class="va">self</span>.N <span class="op">=</span> grid_params</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.activation <span class="op">=</span> activation</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.sym <span class="op">=</span> sym</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Architecture of the Model</span></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.energy_node <span class="op">=</span> nn.Linear(<span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc1_bypass <span class="op">=</span> nn.Linear(<span class="dv">1</span>, <span class="dv">50</span>)</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc1 <span class="op">=</span> nn.Linear(<span class="dv">2</span>, <span class="dv">50</span>)</span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fc2 <span class="op">=</span> nn.Linear(<span class="dv">50</span>, <span class="dv">50</span>)</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Selection of the Output Layer</span></span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> sym <span class="op">==</span> <span class="dv">1</span>:</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Enforcement of Even Symmetry</span></span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_layer <span class="op">=</span> HubLayer(<span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> sym <span class="op">==</span> <span class="op">-</span><span class="dv">1</span>:</span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Enforcement of Odd Symmetry</span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_layer <span class="op">=</span> HubLayer(<span class="dv">50</span>, <span class="dv">1</span>, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>            <span class="co"># No Enforcement of Symmetry</span></span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.output_layer <span class="op">=</span> nn.Linear(<span class="dv">50</span>, <span class="dv">1</span>)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> swap_symmetry(<span class="va">self</span>):</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.sym <span class="op">==</span> <span class="dv">0</span>:</span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'Symmetry cannot be swapped because it is not enforced.'</span>)</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.output_layer.flip_sym()</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Lambda Layer for Energy</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>        energy <span class="op">=</span> <span class="va">self</span>.energy_node(torch.ones_like(x))</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> torch.cat((x, energy), dim<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> <span class="va">self</span>.activation(<span class="va">self</span>.fc1(N))</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> <span class="va">self</span>.activation(<span class="va">self</span>.fc2(N))</span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>        wf <span class="op">=</span> <span class="va">self</span>.output_layer(N) <span class="co"># Possible enforcement of symmetry.</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> wf, energy</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> HubLayer(nn.Module):</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co">    A hub layer, which is used to constrain the prediction of the model</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="co">    to respect even symmetry (symmetry about f(x) = 0) or odd symmetry</span></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="co">    (symmetry about f(x) = x). The mathematical basis is presented at</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="co">    https://arxiv.org/pdf/1904.08991.pdf. The constructor is adapted</span></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="co">    from https://auro-227.medium.com/writing-a-custom-layer-in-pytorch-14ab6ac94b77.</span></span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a><span class="co">    size_in : int</span></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a><span class="co">        The length of the input of the layer.</span></span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a><span class="co">    size_out : int</span></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="co">        The length of the output of the layer.</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a><span class="co">    weights : torch.nn.parameter.Parameter</span></span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a><span class="co">        The weights of the layer.</span></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a><span class="co">    bias : torch.nn.parameter.Parameter</span></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a><span class="co">        The bias of the layer.</span></span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a><span class="co">    even : int</span></span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a><span class="co">        1 to enforce even symmetry.</span></span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a><span class="co">    odd : int</span></span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a><span class="co">        -1 to enforce odd symmetry.</span></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a><span class="co">    Methods</span></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a><span class="co">    flip_sym</span></span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a><span class="co">        Swap the symmetry between even symmetry and odd symmetry.</span></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a><span class="co">    forward(x)</span></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a><span class="co">        Forward pass.</span></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, size_in, size_out, even, odd):</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init__</span>()</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.size_in, <span class="va">self</span>.size_out <span class="op">=</span> size_in, size_out</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>        weights <span class="op">=</span> torch.Tensor(size_out, size_in)</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.weights <span class="op">=</span> nn.Parameter(weights)</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a>        bias <span class="op">=</span> torch.Tensor(size_out)</span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.bias <span class="op">=</span> nn.Parameter(bias)</span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.even <span class="op">=</span> even</span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.odd <span class="op">=</span> odd</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialization of Weights (Kaiming Initialization)</span></span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a>        nn.init.kaiming_uniform_(<span class="va">self</span>.weights, a<span class="op">=</span>np.sqrt(<span class="dv">5</span>))</span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Initialization of Biases (LeCun Initialization)</span></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>        fan_in, _ <span class="op">=</span> nn.init._calculate_fan_in_and_fan_out(<span class="va">self</span>.weights)</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>        bound <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> np.sqrt(fan_in)</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>        nn.init.uniform_(<span class="va">self</span>.bias, <span class="op">-</span>bound, bound)</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> flip_sym(<span class="va">self</span>):</span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.even <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>.even</span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.odd <span class="op">=</span> <span class="dv">1</span> <span class="op">-</span> <span class="va">self</span>.odd</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> forward(<span class="va">self</span>, x):</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>        h_plus <span class="op">=</span> x <span class="co"># This is x(t).</span></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>        h_minus <span class="op">=</span> torch.flip(x, [<span class="dv">0</span>]) <span class="co"># This is x(-t).</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>        H_plus <span class="op">=</span> h_plus <span class="op">+</span> h_minus</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>        H_minus <span class="op">=</span> h_plus <span class="op">-</span> h_minus</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>        N <span class="op">=</span> ((<span class="va">self</span>.even <span class="op">*</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> torch.mm(H_plus, <span class="va">self</span>.weights.t()))</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a>           <span class="op">+</span> (<span class="va">self</span>.odd <span class="op">*</span> (<span class="dv">1</span><span class="op">/</span><span class="dv">2</span>) <span class="op">*</span> torch.mm(H_minus, <span class="va">self</span>.weights.t())))</span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> N</span></code></pre></div>
<hr>
</section>
<section id="step-3-define-the-pinn-class" class="level4">
<h4 data-anchor-id="step-3-define-the-pinn-class">Step 3: Define the <code>PINN</code> Class</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Without Plotting</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false">With Plotting</a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<div class="sourceCode" id="cb8"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PINN():</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An implementation of a physics-informed neural network (PINN) for</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="co">    solving the Schrodinger equation with infrastructure for training</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a><span class="co">    and visualization.</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co">    x : torch.Tensor</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The numerical grid of the physical system.</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a><span class="co">    x0 : float</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="co">        The leftmost point of the numerical grid.</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a><span class="co">    xN : float</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a><span class="co">        The rightmost point of the numerical grid.</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="co">    N : int</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="co">        The count of points that the numerical grid has.</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="co">    V : torch.Tensor</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="co">        The potential.</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="co">    basis : list</span></span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a><span class="co">        The basis.</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a><span class="co">    basis_sum : torch.Tensor</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a><span class="co">        The sum of the eigenvectors of the basis.</span></span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_loss : float</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a><span class="co">        The current loss of the model.</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_energy : float</span></span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a><span class="co">        The current prediction of the energy eigenvalue from the model.</span></span>
<span id="cb8-27"><a href="#cb8-27" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_wf : torch.Tensor</span></span>
<span id="cb8-28"><a href="#cb8-28" aria-hidden="true" tabindex="-1"></a><span class="co">        The current prediction of the energy eigenvector from the model.</span></span>
<span id="cb8-29"><a href="#cb8-29" aria-hidden="true" tabindex="-1"></a><span class="co">    losses : list</span></span>
<span id="cb8-30"><a href="#cb8-30" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all losses of the model.</span></span>
<span id="cb8-31"><a href="#cb8-31" aria-hidden="true" tabindex="-1"></a><span class="co">    energies : list</span></span>
<span id="cb8-32"><a href="#cb8-32" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all energy eigenvalues of the model.</span></span>
<span id="cb8-33"><a href="#cb8-33" aria-hidden="true" tabindex="-1"></a><span class="co">    wfs : list</span></span>
<span id="cb8-34"><a href="#cb8-34" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all energy eigenvectors of the model.</span></span>
<span id="cb8-35"><a href="#cb8-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-36"><a href="#cb8-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Methods</span></span>
<span id="cb8-37"><a href="#cb8-37" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb8-38"><a href="#cb8-38" aria-hidden="true" tabindex="-1"></a><span class="co">    init_optimizer(optimizer_name='LBFGS', lr=1e-3)</span></span>
<span id="cb8-39"><a href="#cb8-39" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the optimizer for training the model.</span></span>
<span id="cb8-40"><a href="#cb8-40" aria-hidden="true" tabindex="-1"></a><span class="co">    change_lr(lr)</span></span>
<span id="cb8-41"><a href="#cb8-41" aria-hidden="true" tabindex="-1"></a><span class="co">        Change the learning rate for training the model.</span></span>
<span id="cb8-42"><a href="#cb8-42" aria-hidden="true" tabindex="-1"></a><span class="co">    swap_symmetry</span></span>
<span id="cb8-43"><a href="#cb8-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Swap the symmetry of the model.</span></span>
<span id="cb8-44"><a href="#cb8-44" aria-hidden="true" tabindex="-1"></a><span class="co">    add_to_basis(base=None)</span></span>
<span id="cb8-45"><a href="#cb8-45" aria-hidden="true" tabindex="-1"></a><span class="co">        Add the predicted energy eigenvector to the basis.</span></span>
<span id="cb8-46"><a href="#cb8-46" aria-hidden="true" tabindex="-1"></a><span class="co">    closure</span></span>
<span id="cb8-47"><a href="#cb8-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Necessary for computing the loss with the L-BFGS optimizer.</span></span>
<span id="cb8-48"><a href="#cb8-48" aria-hidden="true" tabindex="-1"></a><span class="co">    loss_fn(x)</span></span>
<span id="cb8-49"><a href="#cb8-49" aria-hidden="true" tabindex="-1"></a><span class="co">        Computes the loss of the model.</span></span>
<span id="cb8-50"><a href="#cb8-50" aria-hidden="true" tabindex="-1"></a><span class="co">    train(epochs=10)</span></span>
<span id="cb8-51"><a href="#cb8-51" aria-hidden="true" tabindex="-1"></a><span class="co">        Trains the model.</span></span>
<span id="cb8-52"><a href="#cb8-52" aria-hidden="true" tabindex="-1"></a><span class="co">    plot(metrics=['loss', 'energy', 'wf'], ref_energy=None, ref_wf=None)</span></span>
<span id="cb8-53"><a href="#cb8-53" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot a set of metrics.</span></span>
<span id="cb8-54"><a href="#cb8-54" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_loss</span></span>
<span id="cb8-55"><a href="#cb8-55" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the loss.</span></span>
<span id="cb8-56"><a href="#cb8-56" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_energy(ref_energy=None)</span></span>
<span id="cb8-57"><a href="#cb8-57" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the energy eigenvalue that is predicted by the model.</span></span>
<span id="cb8-58"><a href="#cb8-58" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_wf(idx=None, ref_wf=None)</span></span>
<span id="cb8-59"><a href="#cb8-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the energy eigenvector that is predicted by the model.</span></span>
<span id="cb8-60"><a href="#cb8-60" aria-hidden="true" tabindex="-1"></a><span class="co">    animate(filename, ref_energy=None, ref_wf=None, epoch_range=None,</span></span>
<span id="cb8-61"><a href="#cb8-61" aria-hidden="true" tabindex="-1"></a><span class="co">            display=False)</span></span>
<span id="cb8-62"><a href="#cb8-62" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the predictions of the model as an animation.</span></span>
<span id="cb8-63"><a href="#cb8-63" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb8-64"><a href="#cb8-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-65"><a href="#cb8-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, grid_params, activation, potential, sym):</span>
<span id="cb8-66"><a href="#cb8-66" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x0, <span class="va">self</span>.xN, <span class="va">self</span>.dx, <span class="va">self</span>.N <span class="op">=</span> grid_params</span>
<span id="cb8-67"><a href="#cb8-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x <span class="op">=</span> torch.linspace(<span class="va">self</span>.x0, <span class="va">self</span>.xN, <span class="va">self</span>.N <span class="op">-</span> <span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb8-68"><a href="#cb8-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.V <span class="op">=</span> potential</span>
<span id="cb8-69"><a href="#cb8-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-70"><a href="#cb8-70" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> BasePINN(grid_params, activation, sym)</span>
<span id="cb8-71"><a href="#cb8-71" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.to(device)</span>
<span id="cb8-72"><a href="#cb8-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-73"><a href="#cb8-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Persistent information about the predicted basis.</span></span>
<span id="cb8-74"><a href="#cb8-74" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis <span class="op">=</span> []</span>
<span id="cb8-75"><a href="#cb8-75" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis_sum <span class="op">=</span> torch.zeros_like(<span class="va">self</span>.x)</span>
<span id="cb8-76"><a href="#cb8-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-77"><a href="#cb8-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Current values of metrics.</span></span>
<span id="cb8-78"><a href="#cb8-78" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-79"><a href="#cb8-79" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_energy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-80"><a href="#cb8-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_wf <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-81"><a href="#cb8-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-82"><a href="#cb8-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># All values of metrics.</span></span>
<span id="cb8-83"><a href="#cb8-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.losses <span class="op">=</span> []</span>
<span id="cb8-84"><a href="#cb8-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.energies <span class="op">=</span> []</span>
<span id="cb8-85"><a href="#cb8-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.wfs <span class="op">=</span> []</span>
<span id="cb8-86"><a href="#cb8-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-87"><a href="#cb8-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> init_optimizer(<span class="va">self</span>, optimizer_name<span class="op">=</span><span class="st">'LBFGS'</span>, lr<span class="op">=</span><span class="fl">1e-3</span>):</span>
<span id="cb8-88"><a href="#cb8-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> optimizer_name <span class="op">==</span> <span class="st">'LBFGS'</span>:</span>
<span id="cb8-89"><a href="#cb8-89" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer <span class="op">=</span> torch.optim.LBFGS(<span class="va">self</span>.model.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb8-90"><a href="#cb8-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> optimizer_name <span class="op">==</span> <span class="st">'Adam'</span>:</span>
<span id="cb8-91"><a href="#cb8-91" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer <span class="op">=</span> torch.optim.Adam(<span class="va">self</span>.model.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb8-92"><a href="#cb8-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb8-93"><a href="#cb8-93" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'The name of the optimizer is invalid.'</span>)</span>
<span id="cb8-94"><a href="#cb8-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb8-95"><a href="#cb8-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-96"><a href="#cb8-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer_name <span class="op">=</span> optimizer_name</span>
<span id="cb8-97"><a href="#cb8-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-98"><a href="#cb8-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> change_lr(<span class="va">self</span>, lr):</span>
<span id="cb8-99"><a href="#cb8-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-100"><a href="#cb8-100" aria-hidden="true" tabindex="-1"></a><span class="co">        On-the-fly (runtime) control of the learning rate.</span></span>
<span id="cb8-101"><a href="#cb8-101" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-102"><a href="#cb8-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-103"><a href="#cb8-103" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer.param_groups[<span class="dv">0</span>][<span class="st">'lr'</span>] <span class="op">=</span> lr</span>
<span id="cb8-104"><a href="#cb8-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-105"><a href="#cb8-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> swap_symmetry(<span class="va">self</span>):</span>
<span id="cb8-106"><a href="#cb8-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-107"><a href="#cb8-107" aria-hidden="true" tabindex="-1"></a><span class="co">        On-the-fly (runtime) control of the enforced symmetry.</span></span>
<span id="cb8-108"><a href="#cb8-108" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-109"><a href="#cb8-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-110"><a href="#cb8-110" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.swap_symmetry()</span>
<span id="cb8-111"><a href="#cb8-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-112"><a href="#cb8-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_to_basis(<span class="va">self</span>, base<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb8-113"><a href="#cb8-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> base <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb8-114"><a href="#cb8-114" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> <span class="va">self</span>.cur_wf.clone().detach()</span>
<span id="cb8-115"><a href="#cb8-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-116"><a href="#cb8-116" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis.append(base)</span>
<span id="cb8-117"><a href="#cb8-117" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis_sum <span class="op">+=</span> base</span>
<span id="cb8-118"><a href="#cb8-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-119"><a href="#cb8-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> closure(<span class="va">self</span>):</span>
<span id="cb8-120"><a href="#cb8-120" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb8-121"><a href="#cb8-121" aria-hidden="true" tabindex="-1"></a><span class="co">        The closure method is necessary for the L-BFGS optimizer since</span></span>
<span id="cb8-122"><a href="#cb8-122" aria-hidden="true" tabindex="-1"></a><span class="co">        it evaluates the loss of the model at multiple points in</span></span>
<span id="cb8-123"><a href="#cb8-123" aria-hidden="true" tabindex="-1"></a><span class="co">        parameter space at each step of training in contrast with the</span></span>
<span id="cb8-124"><a href="#cb8-124" aria-hidden="true" tabindex="-1"></a><span class="co">        other optimizers in PyTorch.</span></span>
<span id="cb8-125"><a href="#cb8-125" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb8-126"><a href="#cb8-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-127"><a href="#cb8-127" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb8-128"><a href="#cb8-128" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">self</span>.loss_fn(<span class="va">self</span>.x)</span>
<span id="cb8-129"><a href="#cb8-129" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb8-130"><a href="#cb8-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb8-131"><a href="#cb8-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-132"><a href="#cb8-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> loss_fn(<span class="va">self</span>, x):</span>
<span id="cb8-133"><a href="#cb8-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb8-134"><a href="#cb8-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-135"><a href="#cb8-135" aria-hidden="true" tabindex="-1"></a>        wf, energy <span class="op">=</span> <span class="va">self</span>.model(<span class="va">self</span>.x)</span>
<span id="cb8-136"><a href="#cb8-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-137"><a href="#cb8-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First Derivative</span></span>
<span id="cb8-138"><a href="#cb8-138" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> torch.autograd.grad(wf.<span class="bu">sum</span>(), x, create_graph<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb8-139"><a href="#cb8-139" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Second Derivative</span></span>
<span id="cb8-140"><a href="#cb8-140" aria-hidden="true" tabindex="-1"></a>        dd <span class="op">=</span> torch.autograd.grad(d.<span class="bu">sum</span>(), x, create_graph<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb8-141"><a href="#cb8-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-142"><a href="#cb8-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># SE Loss</span></span>
<span id="cb8-143"><a href="#cb8-143" aria-hidden="true" tabindex="-1"></a>        SE_loss <span class="op">=</span> torch.<span class="bu">sum</span>((<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> dd <span class="op">+</span> <span class="va">self</span>.V <span class="op">*</span> wf <span class="op">-</span> energy <span class="op">*</span> wf) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb8-144"><a href="#cb8-144" aria-hidden="true" tabindex="-1"></a>        SE_loss <span class="op">/=</span> <span class="va">self</span>.N</span>
<span id="cb8-145"><a href="#cb8-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-146"><a href="#cb8-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normality Loss</span></span>
<span id="cb8-147"><a href="#cb8-147" aria-hidden="true" tabindex="-1"></a>        normality_loss <span class="op">=</span> (torch.<span class="bu">sum</span>(wf <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span> <span class="op">/</span> <span class="va">self</span>.dx) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb8-148"><a href="#cb8-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-149"><a href="#cb8-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Orthogonality Loss</span></span>
<span id="cb8-150"><a href="#cb8-150" aria-hidden="true" tabindex="-1"></a>        orthogonality_loss <span class="op">=</span> (torch.<span class="bu">sum</span>(wf <span class="op">*</span> <span class="va">self</span>.basis_sum) <span class="op">*</span> <span class="va">self</span>.dx) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb8-151"><a href="#cb8-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-152"><a href="#cb8-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Boundary Loss</span></span>
<span id="cb8-153"><a href="#cb8-153" aria-hidden="true" tabindex="-1"></a>        boundary_loss <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (wf[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> wf[<span class="op">-</span><span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb8-154"><a href="#cb8-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-155"><a href="#cb8-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Total Loss</span></span>
<span id="cb8-156"><a href="#cb8-156" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> SE_loss <span class="op">+</span> normality_loss <span class="op">+</span> orthogonality_loss <span class="op">+</span> boundary_loss</span>
<span id="cb8-157"><a href="#cb8-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-158"><a href="#cb8-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_wf <span class="op">=</span> wf</span>
<span id="cb8-159"><a href="#cb8-159" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_energy <span class="op">=</span> energy[<span class="dv">0</span>].item()</span>
<span id="cb8-160"><a href="#cb8-160" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_loss <span class="op">=</span> loss.item()</span>
<span id="cb8-161"><a href="#cb8-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-162"><a href="#cb8-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb8-163"><a href="#cb8-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-164"><a href="#cb8-164" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train(<span class="va">self</span>, epochs<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb8-165"><a href="#cb8-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> track(<span class="bu">range</span>(epochs), description<span class="op">=</span><span class="st">'Training... '</span>):</span>
<span id="cb8-166"><a href="#cb8-166" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.optimizer_name <span class="op">==</span> <span class="st">'LBFGS'</span>:</span>
<span id="cb8-167"><a href="#cb8-167" aria-hidden="true" tabindex="-1"></a>                loss <span class="op">=</span> <span class="va">self</span>.optimizer.step(<span class="va">self</span>.closure)</span>
<span id="cb8-168"><a href="#cb8-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-169"><a href="#cb8-169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> loss.item() <span class="op">==</span> torch.nan:</span>
<span id="cb8-170"><a href="#cb8-170" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'The loss is NAN.'</span>)</span>
<span id="cb8-171"><a href="#cb8-171" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb8-172"><a href="#cb8-172" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="va">self</span>.optimizer_name <span class="op">==</span> <span class="st">'Adam'</span>:</span>
<span id="cb8-173"><a href="#cb8-173" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb8-174"><a href="#cb8-174" aria-hidden="true" tabindex="-1"></a>                loss <span class="op">=</span> <span class="va">self</span>.loss_fn(<span class="va">self</span>.x)</span>
<span id="cb8-175"><a href="#cb8-175" aria-hidden="true" tabindex="-1"></a>                loss.backward()</span>
<span id="cb8-176"><a href="#cb8-176" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.optimizer.step()</span>
<span id="cb8-177"><a href="#cb8-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-178"><a href="#cb8-178" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.wfs.append(<span class="va">self</span>.cur_wf)</span>
<span id="cb8-179"><a href="#cb8-179" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.energies.append(<span class="va">self</span>.cur_energy)</span>
<span id="cb8-180"><a href="#cb8-180" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.losses.append(<span class="va">self</span>.cur_loss)</span></code></pre></div>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="sourceCode" id="cb9"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> PINN():</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co">    An implementation of a physics-informed neural network (PINN) for</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co">    solving the Schrodinger equation with infrastructure for training</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co">    and visualization.</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co">    Attributes</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a><span class="co">    ----------</span></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co">    x : torch.Tensor</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a><span class="co">        The numerical grid of the physical system.</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a><span class="co">    x0 : float</span></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a><span class="co">        The leftmost point of the numerical grid.</span></span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a><span class="co">    xN : float</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a><span class="co">        The rightmost point of the numerical grid.</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a><span class="co">    N : int</span></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co">        The count of points that the numerical grid has.</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a><span class="co">    V : torch.Tensor</span></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co">        The potential.</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a><span class="co">    basis : list</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a><span class="co">        The basis.</span></span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a><span class="co">    basis_sum : torch.Tensor</span></span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a><span class="co">        The sum of the eigenvectors of the basis.</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_loss : float</span></span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a><span class="co">        The current loss of the model.</span></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_energy : float</span></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co">        The current prediction of the energy eigenvalue from the model.</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a><span class="co">    cur_wf : torch.Tensor</span></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">        The current prediction of the energy eigenvector from the model.</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a><span class="co">    losses : list</span></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all losses of the model.</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a><span class="co">    energies : list</span></span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all energy eigenvalues of the model.</span></span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a><span class="co">    wfs : list</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a><span class="co">        A list of all energy eigenvectors of the model.</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a><span class="co">    Methods</span></span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a><span class="co">    -------</span></span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a><span class="co">    init_optimizer(optimizer_name='LBFGS', lr=1e-3)</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a><span class="co">        Initialize the optimizer for training the model.</span></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a><span class="co">    change_lr(lr)</span></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co">        Change the learning rate for training the model.</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a><span class="co">    swap_symmetry</span></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co">        Swap the symmetry of the model.</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a><span class="co">    add_to_basis(base=None)</span></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a><span class="co">        Add the predicted energy eigenvector to the basis.</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a><span class="co">    closure</span></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="co">        Necessary for computing the loss with the L-BFGS optimizer.</span></span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a><span class="co">    loss_fn(x)</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a><span class="co">        Computes the loss of the model.</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a><span class="co">    train(epochs=10)</span></span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a><span class="co">        Trains the model.</span></span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a><span class="co">    plot(metrics=['loss', 'energy', 'wf'], ref_energy=None, ref_wf=None)</span></span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot a set of metrics.</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_loss</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the loss.</span></span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_energy(ref_energy=None)</span></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the energy eigenvalue that is predicted by the model.</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a><span class="co">    plot_wf(idx=None, ref_wf=None)</span></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the energy eigenvector that is predicted by the model.</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a><span class="co">    animate(filename, ref_energy=None, ref_wf=None, epoch_range=None,</span></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a><span class="co">            display=False)</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a><span class="co">        Plot the predictions of the model as an animation.</span></span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, grid_params, activation, potential, sym):</span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x0, <span class="va">self</span>.xN, <span class="va">self</span>.dx, <span class="va">self</span>.N <span class="op">=</span> grid_params</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x <span class="op">=</span> torch.linspace(<span class="va">self</span>.x0, <span class="va">self</span>.xN, <span class="va">self</span>.N <span class="op">-</span> <span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.V <span class="op">=</span> potential</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model <span class="op">=</span> BasePINN(grid_params, activation, sym)</span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.to(device)</span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Persistent information about the predicted basis.</span></span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis <span class="op">=</span> []</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis_sum <span class="op">=</span> torch.zeros_like(<span class="va">self</span>.x)</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Current values of metrics.</span></span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_loss <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_energy <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_wf <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a>        <span class="co"># All values of metrics.</span></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.losses <span class="op">=</span> []</span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.energies <span class="op">=</span> []</span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.wfs <span class="op">=</span> []</span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> init_optimizer(<span class="va">self</span>, optimizer_name<span class="op">=</span><span class="st">'LBFGS'</span>, lr<span class="op">=</span><span class="fl">1e-3</span>):</span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> optimizer_name <span class="op">==</span> <span class="st">'LBFGS'</span>:</span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer <span class="op">=</span> torch.optim.LBFGS(<span class="va">self</span>.model.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> optimizer_name <span class="op">==</span> <span class="st">'Adam'</span>:</span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.optimizer <span class="op">=</span> torch.optim.Adam(<span class="va">self</span>.model.parameters(), lr<span class="op">=</span>lr)</span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(<span class="st">'The name of the optimizer is invalid.'</span>)</span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a>            <span class="cf">return</span></span>
<span id="cb9-95"><a href="#cb9-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-96"><a href="#cb9-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer_name <span class="op">=</span> optimizer_name</span>
<span id="cb9-97"><a href="#cb9-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-98"><a href="#cb9-98" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> change_lr(<span class="va">self</span>, lr):</span>
<span id="cb9-99"><a href="#cb9-99" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-100"><a href="#cb9-100" aria-hidden="true" tabindex="-1"></a><span class="co">        On-the-fly (runtime) control of the learning rate.</span></span>
<span id="cb9-101"><a href="#cb9-101" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-102"><a href="#cb9-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-103"><a href="#cb9-103" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer.param_groups[<span class="dv">0</span>][<span class="st">'lr'</span>] <span class="op">=</span> lr</span>
<span id="cb9-104"><a href="#cb9-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-105"><a href="#cb9-105" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> swap_symmetry(<span class="va">self</span>):</span>
<span id="cb9-106"><a href="#cb9-106" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-107"><a href="#cb9-107" aria-hidden="true" tabindex="-1"></a><span class="co">        On-the-fly (runtime) control of the enforced symmetry.</span></span>
<span id="cb9-108"><a href="#cb9-108" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-109"><a href="#cb9-109" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-110"><a href="#cb9-110" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.model.swap_symmetry()</span>
<span id="cb9-111"><a href="#cb9-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-112"><a href="#cb9-112" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> add_to_basis(<span class="va">self</span>, base<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-113"><a href="#cb9-113" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> base <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-114"><a href="#cb9-114" aria-hidden="true" tabindex="-1"></a>            base <span class="op">=</span> <span class="va">self</span>.cur_wf.clone().detach()</span>
<span id="cb9-115"><a href="#cb9-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-116"><a href="#cb9-116" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis.append(base)</span>
<span id="cb9-117"><a href="#cb9-117" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.basis_sum <span class="op">+=</span> base</span>
<span id="cb9-118"><a href="#cb9-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-119"><a href="#cb9-119" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> closure(<span class="va">self</span>):</span>
<span id="cb9-120"><a href="#cb9-120" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb9-121"><a href="#cb9-121" aria-hidden="true" tabindex="-1"></a><span class="co">        The closure method is necessary for the L-BFGS optimizer since</span></span>
<span id="cb9-122"><a href="#cb9-122" aria-hidden="true" tabindex="-1"></a><span class="co">        it evaluates the loss of the model at multiple points in</span></span>
<span id="cb9-123"><a href="#cb9-123" aria-hidden="true" tabindex="-1"></a><span class="co">        parameter space at each step of training in contrast with the</span></span>
<span id="cb9-124"><a href="#cb9-124" aria-hidden="true" tabindex="-1"></a><span class="co">        other optimizers in PyTorch.</span></span>
<span id="cb9-125"><a href="#cb9-125" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb9-126"><a href="#cb9-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-127"><a href="#cb9-127" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb9-128"><a href="#cb9-128" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> <span class="va">self</span>.loss_fn(<span class="va">self</span>.x)</span>
<span id="cb9-129"><a href="#cb9-129" aria-hidden="true" tabindex="-1"></a>        loss.backward()</span>
<span id="cb9-130"><a href="#cb9-130" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb9-131"><a href="#cb9-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-132"><a href="#cb9-132" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> loss_fn(<span class="va">self</span>, x):</span>
<span id="cb9-133"><a href="#cb9-133" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.x.requires_grad <span class="op">=</span> <span class="va">True</span></span>
<span id="cb9-134"><a href="#cb9-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-135"><a href="#cb9-135" aria-hidden="true" tabindex="-1"></a>        wf, energy <span class="op">=</span> <span class="va">self</span>.model(<span class="va">self</span>.x)</span>
<span id="cb9-136"><a href="#cb9-136" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-137"><a href="#cb9-137" aria-hidden="true" tabindex="-1"></a>        <span class="co"># First Derivative</span></span>
<span id="cb9-138"><a href="#cb9-138" aria-hidden="true" tabindex="-1"></a>        d <span class="op">=</span> torch.autograd.grad(wf.<span class="bu">sum</span>(), x, create_graph<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb9-139"><a href="#cb9-139" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Second Derivative</span></span>
<span id="cb9-140"><a href="#cb9-140" aria-hidden="true" tabindex="-1"></a>        dd <span class="op">=</span> torch.autograd.grad(d.<span class="bu">sum</span>(), x, create_graph<span class="op">=</span><span class="va">True</span>)[<span class="dv">0</span>]</span>
<span id="cb9-141"><a href="#cb9-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-142"><a href="#cb9-142" aria-hidden="true" tabindex="-1"></a>        <span class="co"># SE Loss</span></span>
<span id="cb9-143"><a href="#cb9-143" aria-hidden="true" tabindex="-1"></a>        SE_loss <span class="op">=</span> torch.<span class="bu">sum</span>((<span class="op">-</span><span class="fl">0.5</span> <span class="op">*</span> dd <span class="op">+</span> <span class="va">self</span>.V <span class="op">*</span> wf <span class="op">-</span> energy <span class="op">*</span> wf) <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb9-144"><a href="#cb9-144" aria-hidden="true" tabindex="-1"></a>        SE_loss <span class="op">/=</span> <span class="va">self</span>.N</span>
<span id="cb9-145"><a href="#cb9-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-146"><a href="#cb9-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Normality Loss</span></span>
<span id="cb9-147"><a href="#cb9-147" aria-hidden="true" tabindex="-1"></a>        normality_loss <span class="op">=</span> (torch.<span class="bu">sum</span>(wf <span class="op">**</span> <span class="dv">2</span>) <span class="op">-</span> <span class="dv">1</span> <span class="op">/</span> <span class="va">self</span>.dx) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-148"><a href="#cb9-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-149"><a href="#cb9-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Orthogonality Loss</span></span>
<span id="cb9-150"><a href="#cb9-150" aria-hidden="true" tabindex="-1"></a>        orthogonality_loss <span class="op">=</span> (torch.<span class="bu">sum</span>(wf <span class="op">*</span> <span class="va">self</span>.basis_sum) <span class="op">*</span> <span class="va">self</span>.dx) <span class="op">**</span> <span class="dv">2</span></span>
<span id="cb9-151"><a href="#cb9-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-152"><a href="#cb9-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Boundary Loss</span></span>
<span id="cb9-153"><a href="#cb9-153" aria-hidden="true" tabindex="-1"></a>        boundary_loss <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> (wf[<span class="dv">0</span>] <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> wf[<span class="op">-</span><span class="dv">1</span>] <span class="op">**</span> <span class="dv">2</span>)</span>
<span id="cb9-154"><a href="#cb9-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-155"><a href="#cb9-155" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Total Loss</span></span>
<span id="cb9-156"><a href="#cb9-156" aria-hidden="true" tabindex="-1"></a>        loss <span class="op">=</span> SE_loss <span class="op">+</span> normality_loss <span class="op">+</span> orthogonality_loss <span class="op">+</span> boundary_loss</span>
<span id="cb9-157"><a href="#cb9-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-158"><a href="#cb9-158" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_wf <span class="op">=</span> wf</span>
<span id="cb9-159"><a href="#cb9-159" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_energy <span class="op">=</span> energy[<span class="dv">0</span>].item()</span>
<span id="cb9-160"><a href="#cb9-160" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.cur_loss <span class="op">=</span> loss.item()</span>
<span id="cb9-161"><a href="#cb9-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-162"><a href="#cb9-162" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> loss</span>
<span id="cb9-163"><a href="#cb9-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-164"><a href="#cb9-164" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> train(<span class="va">self</span>, epochs<span class="op">=</span><span class="dv">10</span>):</span>
<span id="cb9-165"><a href="#cb9-165" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> _ <span class="kw">in</span> track(<span class="bu">range</span>(epochs), description<span class="op">=</span><span class="st">'Training... '</span>):</span>
<span id="cb9-166"><a href="#cb9-166" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> <span class="va">self</span>.optimizer_name <span class="op">==</span> <span class="st">'LBFGS'</span>:</span>
<span id="cb9-167"><a href="#cb9-167" aria-hidden="true" tabindex="-1"></a>                loss <span class="op">=</span> <span class="va">self</span>.optimizer.step(<span class="va">self</span>.closure)</span>
<span id="cb9-168"><a href="#cb9-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-169"><a href="#cb9-169" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> loss.item() <span class="op">==</span> torch.nan:</span>
<span id="cb9-170"><a href="#cb9-170" aria-hidden="true" tabindex="-1"></a>                    <span class="bu">print</span>(<span class="st">'The loss is NAN.'</span>)</span>
<span id="cb9-171"><a href="#cb9-171" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">break</span></span>
<span id="cb9-172"><a href="#cb9-172" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> <span class="va">self</span>.optimizer_name <span class="op">==</span> <span class="st">'Adam'</span>:</span>
<span id="cb9-173"><a href="#cb9-173" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.optimizer.zero_grad()</span>
<span id="cb9-174"><a href="#cb9-174" aria-hidden="true" tabindex="-1"></a>                loss <span class="op">=</span> <span class="va">self</span>.loss_fn(<span class="va">self</span>.x)</span>
<span id="cb9-175"><a href="#cb9-175" aria-hidden="true" tabindex="-1"></a>                loss.backward()</span>
<span id="cb9-176"><a href="#cb9-176" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.optimizer.step()</span>
<span id="cb9-177"><a href="#cb9-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-178"><a href="#cb9-178" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.wfs.append(<span class="va">self</span>.cur_wf)</span>
<span id="cb9-179"><a href="#cb9-179" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.energies.append(<span class="va">self</span>.cur_energy)</span>
<span id="cb9-180"><a href="#cb9-180" aria-hidden="true" tabindex="-1"></a>            <span class="va">self</span>.losses.append(<span class="va">self</span>.cur_loss)</span>
<span id="cb9-181"><a href="#cb9-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-182"><a href="#cb9-182" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot(<span class="va">self</span>, metrics<span class="op">=</span>[<span class="st">'loss'</span>, <span class="st">'energy'</span>, <span class="st">'wf'</span>], ref_energy<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb9-183"><a href="#cb9-183" aria-hidden="true" tabindex="-1"></a>             ref_wf<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-184"><a href="#cb9-184" aria-hidden="true" tabindex="-1"></a>        <span class="kw">def</span> route(metric):</span>
<span id="cb9-185"><a href="#cb9-185" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> metric <span class="op">==</span> <span class="st">'loss'</span>:</span>
<span id="cb9-186"><a href="#cb9-186" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.plot_loss()</span>
<span id="cb9-187"><a href="#cb9-187" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> metric <span class="op">==</span> <span class="st">'energy'</span>:</span>
<span id="cb9-188"><a href="#cb9-188" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.plot_energy(ref_energy<span class="op">=</span>ref_energy)</span>
<span id="cb9-189"><a href="#cb9-189" aria-hidden="true" tabindex="-1"></a>            <span class="cf">elif</span> metric <span class="op">==</span> <span class="st">'wf'</span>:</span>
<span id="cb9-190"><a href="#cb9-190" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.plot_wf(ref_wf<span class="op">=</span>ref_wf)</span>
<span id="cb9-191"><a href="#cb9-191" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb9-192"><a href="#cb9-192" aria-hidden="true" tabindex="-1"></a>                message <span class="op">=</span> <span class="st">'The metric must be </span><span class="ch">\'</span><span class="st">loss</span><span class="ch">\'</span><span class="st">, </span><span class="ch">\'</span><span class="st">energy</span><span class="ch">\'</span><span class="st">, or </span><span class="ch">\'</span><span class="st">wf</span><span class="ch">\'</span><span class="st"> '</span></span>
<span id="cb9-193"><a href="#cb9-193" aria-hidden="true" tabindex="-1"></a>                message <span class="op">+=</span> <span class="ss">f'rather than </span><span class="sc">{</span><span class="bu">repr</span>(metric)<span class="sc">}</span><span class="ss">.'</span></span>
<span id="cb9-194"><a href="#cb9-194" aria-hidden="true" tabindex="-1"></a>                <span class="bu">print</span>(message)</span>
<span id="cb9-195"><a href="#cb9-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-196"><a href="#cb9-196" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(metrics, <span class="bu">str</span>):</span>
<span id="cb9-197"><a href="#cb9-197" aria-hidden="true" tabindex="-1"></a>            route(metrics)</span>
<span id="cb9-198"><a href="#cb9-198" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> <span class="bu">isinstance</span>(metrics, <span class="bu">list</span>):</span>
<span id="cb9-199"><a href="#cb9-199" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> metric <span class="kw">in</span> metrics:</span>
<span id="cb9-200"><a href="#cb9-200" aria-hidden="true" tabindex="-1"></a>                route(metric)</span>
<span id="cb9-201"><a href="#cb9-201" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-202"><a href="#cb9-202" aria-hidden="true" tabindex="-1"></a>            message <span class="op">=</span> <span class="ss">f'The type of the metrics parameter must be </span><span class="sc">{</span><span class="bu">repr</span>(<span class="bu">str</span>)<span class="sc">}</span><span class="ss"> '</span></span>
<span id="cb9-203"><a href="#cb9-203" aria-hidden="true" tabindex="-1"></a>            message <span class="op">+=</span> <span class="ss">f'or </span><span class="sc">{</span><span class="bu">repr</span>(<span class="bu">list</span>)<span class="sc">}</span><span class="ss"> rather than </span><span class="sc">{</span><span class="bu">type</span>(metrics)<span class="sc">}</span><span class="ss">.'</span></span>
<span id="cb9-204"><a href="#cb9-204" aria-hidden="true" tabindex="-1"></a>            <span class="bu">print</span>(message)</span>
<span id="cb9-205"><a href="#cb9-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-206"><a href="#cb9-206" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_loss(<span class="va">self</span>):</span>
<span id="cb9-207"><a href="#cb9-207" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="fl">6.4</span>, <span class="fl">4.8</span>))</span>
<span id="cb9-208"><a href="#cb9-208" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="va">self</span>.losses)</span>
<span id="cb9-209"><a href="#cb9-209" aria-hidden="true" tabindex="-1"></a>        plt.yscale(<span class="st">'log'</span>)</span>
<span id="cb9-210"><a href="#cb9-210" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Loss during Training'</span>, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-211"><a href="#cb9-211" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-212"><a href="#cb9-212" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Loss'</span>)</span>
<span id="cb9-213"><a href="#cb9-213" aria-hidden="true" tabindex="-1"></a>        plt.subplots_adjust(left<span class="op">=</span><span class="fl">0.2</span>, right<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb9-214"><a href="#cb9-214" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.losses) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb9-215"><a href="#cb9-215" aria-hidden="true" tabindex="-1"></a>            plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.losses)))</span>
<span id="cb9-216"><a href="#cb9-216" aria-hidden="true" tabindex="-1"></a>        plt.grid(alpha<span class="op">=</span><span class="fl">0.2</span>, which<span class="op">=</span><span class="st">'both'</span>)</span>
<span id="cb9-217"><a href="#cb9-217" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb9-218"><a href="#cb9-218" aria-hidden="true" tabindex="-1"></a>        plt.close()</span>
<span id="cb9-219"><a href="#cb9-219" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-220"><a href="#cb9-220" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_energy(<span class="va">self</span>, ref_energy<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-221"><a href="#cb9-221" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="fl">6.4</span>, <span class="fl">4.8</span>))</span>
<span id="cb9-222"><a href="#cb9-222" aria-hidden="true" tabindex="-1"></a>        plt.plot(<span class="va">self</span>.energies)</span>
<span id="cb9-223"><a href="#cb9-223" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ref_energy <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-224"><a href="#cb9-224" aria-hidden="true" tabindex="-1"></a>            plt.axhline(ref_energy, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb9-225"><a href="#cb9-225" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="st">'Ground Truth'</span>)</span>
<span id="cb9-226"><a href="#cb9-226" aria-hidden="true" tabindex="-1"></a>        plt.title(<span class="st">'Energy Eigenvalue during Training'</span>, loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-227"><a href="#cb9-227" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-228"><a href="#cb9-228" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Energy Eigenvalue'</span>)</span>
<span id="cb9-229"><a href="#cb9-229" aria-hidden="true" tabindex="-1"></a>        plt.subplots_adjust(left<span class="op">=</span><span class="fl">0.15</span>, right<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb9-230"><a href="#cb9-230" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(<span class="va">self</span>.energies) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb9-231"><a href="#cb9-231" aria-hidden="true" tabindex="-1"></a>            plt.xticks(<span class="bu">range</span>(<span class="bu">len</span>(<span class="va">self</span>.energies)))</span>
<span id="cb9-232"><a href="#cb9-232" aria-hidden="true" tabindex="-1"></a>        plt.grid(alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-233"><a href="#cb9-233" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb9-234"><a href="#cb9-234" aria-hidden="true" tabindex="-1"></a>        plt.close()</span>
<span id="cb9-235"><a href="#cb9-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-236"><a href="#cb9-236" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> plot_wf(<span class="va">self</span>, idx<span class="op">=</span><span class="va">None</span>, ref_wf<span class="op">=</span><span class="va">None</span>):</span>
<span id="cb9-237"><a href="#cb9-237" aria-hidden="true" tabindex="-1"></a>        _ <span class="op">=</span> plt.figure(figsize<span class="op">=</span>(<span class="fl">6.4</span>, <span class="fl">4.8</span>))</span>
<span id="cb9-238"><a href="#cb9-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-239"><a href="#cb9-239" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> idx <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-240"><a href="#cb9-240" aria-hidden="true" tabindex="-1"></a>            psi <span class="op">=</span> <span class="va">self</span>.cur_wf</span>
<span id="cb9-241"><a href="#cb9-241" aria-hidden="true" tabindex="-1"></a>            energy <span class="op">=</span> <span class="va">self</span>.cur_energy</span>
<span id="cb9-242"><a href="#cb9-242" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb9-243"><a href="#cb9-243" aria-hidden="true" tabindex="-1"></a>            psi <span class="op">=</span> <span class="va">self</span>.wfs[idx]</span>
<span id="cb9-244"><a href="#cb9-244" aria-hidden="true" tabindex="-1"></a>            energy <span class="op">=</span> <span class="va">self</span>.energies[idx]</span>
<span id="cb9-245"><a href="#cb9-245" aria-hidden="true" tabindex="-1"></a>        norm <span class="op">=</span> torch.<span class="bu">sum</span>(psi <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> <span class="va">self</span>.dx</span>
<span id="cb9-246"><a href="#cb9-246" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-247"><a href="#cb9-247" aria-hidden="true" tabindex="-1"></a>        plt.plot(to_plot(<span class="va">self</span>.x), to_plot(psi), <span class="st">'r-'</span>, label<span class="op">=</span><span class="st">'Prediction'</span>)</span>
<span id="cb9-248"><a href="#cb9-248" aria-hidden="true" tabindex="-1"></a>        plt.plot(to_plot(<span class="va">self</span>.x), <span class="op">-</span>to_plot(psi), <span class="st">'b-'</span>, label<span class="op">=</span><span class="st">'- Prediction'</span>)</span>
<span id="cb9-249"><a href="#cb9-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-250"><a href="#cb9-250" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> ref_wf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-251"><a href="#cb9-251" aria-hidden="true" tabindex="-1"></a>            plt.plot(to_plot(<span class="va">self</span>.x), ref_wf, <span class="st">'k--'</span>, label<span class="op">=</span><span class="st">'Ground Truth'</span>)</span>
<span id="cb9-252"><a href="#cb9-252" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-253"><a href="#cb9-253" aria-hidden="true" tabindex="-1"></a>        title <span class="op">=</span> <span class="ss">f'Energy Eigenvector (Norm of </span><span class="sc">{</span>norm<span class="sc">:.2f}</span><span class="ss"> and Energy of '</span></span>
<span id="cb9-254"><a href="#cb9-254" aria-hidden="true" tabindex="-1"></a>        title <span class="op">+=</span> <span class="ss">f'</span><span class="sc">{</span>energy<span class="sc">:.2f}</span><span class="ss">)'</span></span>
<span id="cb9-255"><a href="#cb9-255" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-256"><a href="#cb9-256" aria-hidden="true" tabindex="-1"></a>        plt.title(title,</span>
<span id="cb9-257"><a href="#cb9-257" aria-hidden="true" tabindex="-1"></a>                  loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-258"><a href="#cb9-258" aria-hidden="true" tabindex="-1"></a>        plt.xlabel(<span class="st">'Position'</span>)</span>
<span id="cb9-259"><a href="#cb9-259" aria-hidden="true" tabindex="-1"></a>        plt.ylabel(<span class="st">'Probability Amplitude'</span>)</span>
<span id="cb9-260"><a href="#cb9-260" aria-hidden="true" tabindex="-1"></a>        plt.subplots_adjust(left<span class="op">=</span><span class="fl">0.15</span>, right<span class="op">=</span><span class="fl">0.95</span>)</span>
<span id="cb9-261"><a href="#cb9-261" aria-hidden="true" tabindex="-1"></a>        plt.grid(alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-262"><a href="#cb9-262" aria-hidden="true" tabindex="-1"></a>        plt.legend()</span>
<span id="cb9-263"><a href="#cb9-263" aria-hidden="true" tabindex="-1"></a>        plt.show()</span>
<span id="cb9-264"><a href="#cb9-264" aria-hidden="true" tabindex="-1"></a>        plt.close()</span>
<span id="cb9-265"><a href="#cb9-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-266"><a href="#cb9-266" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> animate(<span class="va">self</span>, filename<span class="op">=</span><span class="va">None</span>, ref_wf<span class="op">=</span><span class="va">None</span>, ref_energy<span class="op">=</span><span class="va">None</span>,</span>
<span id="cb9-267"><a href="#cb9-267" aria-hidden="true" tabindex="-1"></a>                epoch_range<span class="op">=</span><span class="va">None</span>, display_plot<span class="op">=</span><span class="va">True</span>, display_progress<span class="op">=</span><span class="va">False</span>):</span>
<span id="cb9-268"><a href="#cb9-268" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Use rich.progress.Progress to display progress.</span></span>
<span id="cb9-269"><a href="#cb9-269" aria-hidden="true" tabindex="-1"></a>        column_list <span class="op">=</span> [TextColumn(<span class="st">'Animating...'</span>),</span>
<span id="cb9-270"><a href="#cb9-270" aria-hidden="true" tabindex="-1"></a>                       BarColumn(),</span>
<span id="cb9-271"><a href="#cb9-271" aria-hidden="true" tabindex="-1"></a>                       TaskProgressColumn(),</span>
<span id="cb9-272"><a href="#cb9-272" aria-hidden="true" tabindex="-1"></a>                       TimeRemainingColumn(elapsed_when_finished<span class="op">=</span><span class="va">True</span>)]</span>
<span id="cb9-273"><a href="#cb9-273" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> Progress(<span class="op">*</span>column_list) <span class="im">as</span> progress:</span>
<span id="cb9-274"><a href="#cb9-274" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> epoch_range <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-275"><a href="#cb9-275" aria-hidden="true" tabindex="-1"></a>                epoch_range <span class="op">=</span> (<span class="dv">0</span>, <span class="bu">len</span>(<span class="va">self</span>.losses))</span>
<span id="cb9-276"><a href="#cb9-276" aria-hidden="true" tabindex="-1"></a>            num_frames <span class="op">=</span> epoch_range[<span class="dv">1</span>] <span class="op">-</span> epoch_range[<span class="dv">0</span>]</span>
<span id="cb9-277"><a href="#cb9-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-278"><a href="#cb9-278" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> display_progress:</span>
<span id="cb9-279"><a href="#cb9-279" aria-hidden="true" tabindex="-1"></a>                task <span class="op">=</span> progress.add_task(<span class="st">'Animating...'</span>,</span>
<span id="cb9-280"><a href="#cb9-280" aria-hidden="true" tabindex="-1"></a>                                         total<span class="op">=</span>num_frames)</span>
<span id="cb9-281"><a href="#cb9-281" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-282"><a href="#cb9-282" aria-hidden="true" tabindex="-1"></a>            fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">4</span>))</span>
<span id="cb9-283"><a href="#cb9-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-284"><a href="#cb9-284" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Function for FuncAnimation in Matplotlib</span></span>
<span id="cb9-285"><a href="#cb9-285" aria-hidden="true" tabindex="-1"></a>            <span class="kw">def</span> plot_frame(i):</span>
<span id="cb9-286"><a href="#cb9-286" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> display_progress:</span>
<span id="cb9-287"><a href="#cb9-287" aria-hidden="true" tabindex="-1"></a>                    progress.update(task, advance<span class="op">=</span><span class="dv">1</span>)</span>
<span id="cb9-288"><a href="#cb9-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-289"><a href="#cb9-289" aria-hidden="true" tabindex="-1"></a>                idx <span class="op">=</span> epoch_range[<span class="dv">0</span>] <span class="op">+</span> i</span>
<span id="cb9-290"><a href="#cb9-290" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-291"><a href="#cb9-291" aria-hidden="true" tabindex="-1"></a>                psi <span class="op">=</span> <span class="va">self</span>.wfs[idx]</span>
<span id="cb9-292"><a href="#cb9-292" aria-hidden="true" tabindex="-1"></a>                norm <span class="op">=</span> torch.<span class="bu">sum</span>(psi <span class="op">**</span> <span class="dv">2</span>) <span class="op">*</span> <span class="va">self</span>.dx</span>
<span id="cb9-293"><a href="#cb9-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-294"><a href="#cb9-294" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Plot Energy Eigenvector</span></span>
<span id="cb9-295"><a href="#cb9-295" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> axes[<span class="dv">0</span>]</span>
<span id="cb9-296"><a href="#cb9-296" aria-hidden="true" tabindex="-1"></a>                ax.clear()</span>
<span id="cb9-297"><a href="#cb9-297" aria-hidden="true" tabindex="-1"></a>                ax.plot(to_plot(<span class="va">self</span>.x),</span>
<span id="cb9-298"><a href="#cb9-298" aria-hidden="true" tabindex="-1"></a>                        to_plot(<span class="va">self</span>.wfs[idx]),</span>
<span id="cb9-299"><a href="#cb9-299" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'r-'</span>,</span>
<span id="cb9-300"><a href="#cb9-300" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="st">'Prediction'</span>)</span>
<span id="cb9-301"><a href="#cb9-301" aria-hidden="true" tabindex="-1"></a>                ax.plot(to_plot(<span class="va">self</span>.x),</span>
<span id="cb9-302"><a href="#cb9-302" aria-hidden="true" tabindex="-1"></a>                        <span class="op">-</span>to_plot(<span class="va">self</span>.wfs[idx]),</span>
<span id="cb9-303"><a href="#cb9-303" aria-hidden="true" tabindex="-1"></a>                        <span class="st">'b-'</span>,</span>
<span id="cb9-304"><a href="#cb9-304" aria-hidden="true" tabindex="-1"></a>                        label<span class="op">=</span><span class="st">'- Prediction'</span>)</span>
<span id="cb9-305"><a href="#cb9-305" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ref_wf <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-306"><a href="#cb9-306" aria-hidden="true" tabindex="-1"></a>                    ax.plot(to_plot(<span class="va">self</span>.x),</span>
<span id="cb9-307"><a href="#cb9-307" aria-hidden="true" tabindex="-1"></a>                            ref_wf,</span>
<span id="cb9-308"><a href="#cb9-308" aria-hidden="true" tabindex="-1"></a>                            <span class="st">'k--'</span>,</span>
<span id="cb9-309"><a href="#cb9-309" aria-hidden="true" tabindex="-1"></a>                            label<span class="op">=</span><span class="st">'Ground Truth'</span>)</span>
<span id="cb9-310"><a href="#cb9-310" aria-hidden="true" tabindex="-1"></a>                ax.set_title(<span class="ss">f'Energy Eigenvector: Norm of </span><span class="sc">{</span>norm<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb9-311"><a href="#cb9-311" aria-hidden="true" tabindex="-1"></a>                             loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-312"><a href="#cb9-312" aria-hidden="true" tabindex="-1"></a>                ax.set_xlabel(<span class="st">'Position'</span>)</span>
<span id="cb9-313"><a href="#cb9-313" aria-hidden="true" tabindex="-1"></a>                ax.set_ylabel(<span class="st">'Probability Amplitude'</span>)</span>
<span id="cb9-314"><a href="#cb9-314" aria-hidden="true" tabindex="-1"></a>                ax.set_ylim([<span class="op">-</span><span class="fl">1.5</span>, <span class="fl">1.5</span>])</span>
<span id="cb9-315"><a href="#cb9-315" aria-hidden="true" tabindex="-1"></a>                ax.grid(alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-316"><a href="#cb9-316" aria-hidden="true" tabindex="-1"></a>                ax.legend()</span>
<span id="cb9-317"><a href="#cb9-317" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-318"><a href="#cb9-318" aria-hidden="true" tabindex="-1"></a>                <span class="co"># Plot Energy Eigenvalue</span></span>
<span id="cb9-319"><a href="#cb9-319" aria-hidden="true" tabindex="-1"></a>                ax <span class="op">=</span> axes[<span class="dv">1</span>]</span>
<span id="cb9-320"><a href="#cb9-320" aria-hidden="true" tabindex="-1"></a>                ax.clear()</span>
<span id="cb9-321"><a href="#cb9-321" aria-hidden="true" tabindex="-1"></a>                ax.plot(np.arange(epoch_range[<span class="dv">0</span>], idx <span class="op">+</span> <span class="dv">1</span>),</span>
<span id="cb9-322"><a href="#cb9-322" aria-hidden="true" tabindex="-1"></a>                        <span class="va">self</span>.energies[epoch_range[<span class="dv">0</span>]:idx <span class="op">+</span> <span class="dv">1</span>])</span>
<span id="cb9-323"><a href="#cb9-323" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> ref_energy <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb9-324"><a href="#cb9-324" aria-hidden="true" tabindex="-1"></a>                    ax.axhline(ref_energy, color<span class="op">=</span><span class="st">'k'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>,</span>
<span id="cb9-325"><a href="#cb9-325" aria-hidden="true" tabindex="-1"></a>                               label<span class="op">=</span><span class="st">'Ground Truth'</span>)</span>
<span id="cb9-326"><a href="#cb9-326" aria-hidden="true" tabindex="-1"></a>                ax.set_title(<span class="ss">f'Energy Eigenvalue: </span><span class="sc">{</span><span class="va">self</span><span class="sc">.</span>energies[idx]<span class="sc">:.2f}</span><span class="ss">'</span>,</span>
<span id="cb9-327"><a href="#cb9-327" aria-hidden="true" tabindex="-1"></a>                             loc<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb9-328"><a href="#cb9-328" aria-hidden="true" tabindex="-1"></a>                ax.set_xlabel(<span class="st">'Epoch'</span>)</span>
<span id="cb9-329"><a href="#cb9-329" aria-hidden="true" tabindex="-1"></a>                ax.set_ylabel(<span class="st">'Energy Eigenvalue'</span>)</span>
<span id="cb9-330"><a href="#cb9-330" aria-hidden="true" tabindex="-1"></a>                ax.set_xlim([epoch_range[<span class="dv">0</span>], epoch_range[<span class="dv">1</span>]])</span>
<span id="cb9-331"><a href="#cb9-331" aria-hidden="true" tabindex="-1"></a>                ax.grid(alpha<span class="op">=</span><span class="fl">0.2</span>)</span>
<span id="cb9-332"><a href="#cb9-332" aria-hidden="true" tabindex="-1"></a>                ax.legend()</span>
<span id="cb9-333"><a href="#cb9-333" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-334"><a href="#cb9-334" aria-hidden="true" tabindex="-1"></a>            ani <span class="op">=</span> FuncAnimation(fig, plot_frame, frames<span class="op">=</span>num_frames <span class="op">-</span> <span class="dv">1</span>,</span>
<span id="cb9-335"><a href="#cb9-335" aria-hidden="true" tabindex="-1"></a>                                interval<span class="op">=</span><span class="dv">300</span>)</span>
<span id="cb9-336"><a href="#cb9-336" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-337"><a href="#cb9-337" aria-hidden="true" tabindex="-1"></a>            <span class="co"># Save the Animation</span></span>
<span id="cb9-338"><a href="#cb9-338" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> filename <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb9-339"><a href="#cb9-339" aria-hidden="true" tabindex="-1"></a>                dir_str <span class="op">=</span> <span class="st">'sepinn_output'</span></span>
<span id="cb9-340"><a href="#cb9-340" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="kw">not</span> os.path.isdir(dir_str):</span>
<span id="cb9-341"><a href="#cb9-341" aria-hidden="true" tabindex="-1"></a>                    os.mkdir(dir_str)</span>
<span id="cb9-342"><a href="#cb9-342" aria-hidden="true" tabindex="-1"></a>                time_str <span class="op">=</span> datetime.now().strftime(<span class="st">"%Y-%m-</span><span class="sc">%d</span><span class="st">_%H-%M-%S"</span>)</span>
<span id="cb9-343"><a href="#cb9-343" aria-hidden="true" tabindex="-1"></a>                filename <span class="op">=</span> os.path.join(dir_str, time_str <span class="op">+</span> <span class="st">'.gif'</span>)</span>
<span id="cb9-344"><a href="#cb9-344" aria-hidden="true" tabindex="-1"></a>            ani.save(filename, dpi<span class="op">=</span><span class="dv">200</span>, writer<span class="op">=</span>PillowWriter(fps<span class="op">=</span><span class="dv">50</span>))</span>
<span id="cb9-345"><a href="#cb9-345" aria-hidden="true" tabindex="-1"></a>            plt.close()</span>
<span id="cb9-346"><a href="#cb9-346" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb9-347"><a href="#cb9-347" aria-hidden="true" tabindex="-1"></a>            <span class="cf">if</span> display_plot:</span>
<span id="cb9-348"><a href="#cb9-348" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> <span class="st">'google.colab'</span> <span class="kw">in</span> sys.modules:</span>
<span id="cb9-349"><a href="#cb9-349" aria-hidden="true" tabindex="-1"></a>                    filename <span class="op">=</span> <span class="st">'/content/'</span> <span class="op">+</span> filename</span>
<span id="cb9-350"><a href="#cb9-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-351"><a href="#cb9-351" aria-hidden="true" tabindex="-1"></a>                display(Image(filename))</span></code></pre></div>
</div>
</div>
</div>
<hr>
</section>
<section id="step-4-define-the-physical-system" class="level4">
<h4 data-anchor-id="step-4-define-the-physical-system">Step 4: Define the Physical System</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Parameters of a Quantum Harmonic Oscillator</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>N <span class="op">=</span> <span class="dv">500</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x0, xN <span class="op">=</span> <span class="op">-</span><span class="fl">5.0</span>, <span class="fl">5.0</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> (xN <span class="op">-</span> x0) <span class="op">/</span> N</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>grid_params <span class="op">=</span> x0, xN, dx, N</span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> torch.linspace(x0, xN, N <span class="op">+</span> <span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>k <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>V <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> k <span class="op">*</span> x <span class="op">**</span> <span class="dv">2</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Finite differences for the ground state.</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>diagonal <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> dx <span class="op">**</span> <span class="dv">2</span> <span class="op">+</span> V[<span class="dv">1</span>:<span class="op">-</span><span class="dv">1</span>].detach().cpu().numpy()[:, <span class="dv">0</span>]</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>edge <span class="op">=</span> <span class="op">-</span><span class="fl">0.5</span> <span class="op">/</span> dx <span class="op">**</span> <span class="dv">2</span> <span class="op">*</span> np.ones(diagonal.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="dv">1</span>)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>energies, eigenvectors <span class="op">=</span> eigh_tridiagonal(diagonal, edge)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Normalization of eigenvectors.</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>norms <span class="op">=</span> dx <span class="op">*</span> np.<span class="bu">sum</span>(eigenvectors <span class="op">**</span> <span class="dv">2</span>, axis<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>eigenvectors <span class="op">/=</span> np.sqrt(norms)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>eigenvectors <span class="op">=</span> eigenvectors.T</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>gnd_state <span class="op">=</span> eigenvectors[<span class="dv">0</span>]</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>gnd_energy <span class="op">=</span> energies[<span class="dv">0</span>]</span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-16"><a href="#cb11-16" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> torch.linspace(x0, xN, N <span class="op">-</span> <span class="dv">1</span>).view(<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb11-17"><a href="#cb11-17" aria-hidden="true" tabindex="-1"></a>V <span class="op">=</span> <span class="fl">0.5</span> <span class="op">*</span> k <span class="op">*</span> x <span class="op">**</span> <span class="dv">2</span></span></code></pre></div>
<hr>
</section>
<section id="step-5-apply-the-pinn-class" class="level4">
<h4 data-anchor-id="step-5-apply-the-pinn-class">Step 5: Apply the <code>PINN</code> Class</h4>
<p>Initialize a PINN.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>params <span class="op">=</span> {<span class="st">'grid_params'</span>: grid_params,</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>          <span class="st">'activation'</span>: torch.tanh,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>          <span class="st">'potential'</span>: V,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>          <span class="st">'sym'</span>: <span class="dv">1</span>}</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>pinn <span class="op">=</span> PINN(<span class="op">**</span>params)</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>pinn.init_optimizer(<span class="st">'LBFGS'</span>, lr<span class="op">=</span><span class="fl">1e-3</span>)</span></code></pre></div>
<p>Initiate training.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>pinn.train(<span class="dv">250</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>pinn.plot_loss()</span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sepinn_1.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
<p>Resume training.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>pinn.train(<span class="dv">250</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>pinn.plot_loss()</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>pinn.plot_energy()</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>pinn.plot_wf(ref_wf<span class="op">=</span>gnd_state)</span></code></pre></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sepinn_2.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sepinn_3.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/sepinn_4.png" class="quarto-figure quarto-figure-center figure-img" height="300"></p>
</figure>
</div>
<div class="sourceCode" id="cb15"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>pinn.train(<span class="dv">100</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Visualize</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>pinn.animate(ref_energy<span class="op">=</span>gnd_energy, ref_wf<span class="op">=</span>gnd_state)</span></code></pre></div>
<p><img src="images/sepinn_5.gif" class="img-fluid"></p>
<p>Compare with a PINN for which symmetry is not enforced.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>params[<span class="st">'sym'</span>] <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pinn_without_sym <span class="op">=</span> PINN(<span class="op">**</span>params)</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>pinn_without_sym.init_optimizer(<span class="st">'LBFGS'</span>, lr<span class="op">=</span><span class="fl">1e-3</span>)</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>pinn_without_sym.train(<span class="dv">600</span>)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>pinn_without_sym.animate(ref_energy<span class="op">=</span>gnd_energy, ref_wf<span class="op">=</span>gnd_state)</span></code></pre></div>
<p><img src="images/sepinn_6.gif" class="img-fluid"></p>
<hr>
</section>
</section>
<section id="afterword" class="level3">
<h3 data-anchor-id="afterword"><strong>Afterword</strong></h3>
<section id="github-repository" class="level4">
<h4 data-anchor-id="github-repository">GitHub Repository</h4>
<p>The repository for SE-PINN is hosted on GitHub at <a href="https://github.com/SE-PINN/SE-PINN"><ins>https://github.com/SE-PINN/SE-PINN</ins></a>.</p>
</section>
<section id="references" class="level4">
<h4 data-anchor-id="references">References</h4>
<p><a href="https://arxiv.org/abs/2203.00451"><ins>https://arxiv.org/abs/2203.00451</ins></a></p>
<p><a href="https://arxiv.org/abs/1904.08991"><ins>https://arxiv.org/abs/1904.08991</ins></a></p>
<hr>


</section>
</section>

</main> <!-- /main -->
<script type="application/vnd.jupyter.widget-state+json">
{"2557f1d9a3a545fdbbcd4ba4379d058a":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/output","_model_module_version":"1.0.0","_model_name":"OutputModel","_view_count":null,"_view_module":"@jupyter-widgets/output","_view_module_version":"1.0.0","_view_name":"OutputView","layout":"IPY_MODEL_31f2f9976c0947f68b0232817216fd18","msg_id":"","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n","text/plain":""},"metadata":{},"output_type":"display_data"}]}},"31f2f9976c0947f68b0232817216fd18":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"388e03be57814a5a835d78c7ceacc592":{"model_module":"@jupyter-widgets/base","model_module_version":"1.2.0","model_name":"LayoutModel","state":{"_model_module":"@jupyter-widgets/base","_model_module_version":"1.2.0","_model_name":"LayoutModel","_view_count":null,"_view_module":"@jupyter-widgets/base","_view_module_version":"1.2.0","_view_name":"LayoutView","align_content":null,"align_items":null,"align_self":null,"border":null,"bottom":null,"display":null,"flex":null,"flex_flow":null,"grid_area":null,"grid_auto_columns":null,"grid_auto_flow":null,"grid_auto_rows":null,"grid_column":null,"grid_gap":null,"grid_row":null,"grid_template_areas":null,"grid_template_columns":null,"grid_template_rows":null,"height":null,"justify_content":null,"justify_items":null,"left":null,"margin":null,"max_height":null,"max_width":null,"min_height":null,"min_width":null,"object_fit":null,"object_position":null,"order":null,"overflow":null,"overflow_x":null,"overflow_y":null,"padding":null,"right":null,"top":null,"visibility":null,"width":null}},"ef852a8755164484bab79e91295ad6d5":{"model_module":"@jupyter-widgets/output","model_module_version":"1.0.0","model_name":"OutputModel","state":{"_dom_classes":[],"_model_module":"@jupyter-widgets/output","_model_module_version":"1.0.0","_model_name":"OutputModel","_view_count":null,"_view_module":"@jupyter-widgets/output","_view_module_version":"1.0.0","_view_name":"OutputView","layout":"IPY_MODEL_388e03be57814a5a835d78c7ceacc592","msg_id":"","outputs":[{"data":{"text/html":"<pre style=\"white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace\"></pre>\n","text/plain":""},"metadata":{},"output_type":"display_data"}]}}}
</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/se-pinn\.github\.io\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      const annoteTargets = window.document.querySelectorAll('.code-annotation-anchor');
      for (let i=0; i<annoteTargets.length; i++) {
        const annoteTarget = annoteTargets[i];
        const targetCell = annoteTarget.getAttribute("data-target-cell");
        const targetAnnotation = annoteTarget.getAttribute("data-target-annotation");
        const contentFn = () => {
          const content = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          if (content) {
            const tipContent = content.cloneNode(true);
            tipContent.classList.add("code-annotation-tip-content");
            return tipContent.outerHTML;
          }
        }
        const config = {
          allowHTML: true,
          content: contentFn,
          onShow: (instance) => {
            selectCodeLines(instance.reference);
            instance.reference.classList.add('code-annotation-active');
            window.tippy.hideAll();
          },
          onHide: (instance) => {
            unselectCodeLines();
            instance.reference.classList.remove('code-annotation-active');
          },
          maxWidth: 300,
          delay: [50, 0],
          duration: [200, 0],
          offset: [5, 10],
          arrow: true,
          appendTo: function(el) {
            return el.parentElement.parentElement.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'quarto',
          placement: 'right',
          popperOptions: {
            modifiers: [
            {
              name: 'flip',
              options: {
                flipVariations: false, // true by default
                allowedAutoPlacements: ['right'],
                fallbackPlacements: ['right', 'top', 'top-start', 'top-end', 'bottom', 'bottom-start', 'bottom-end', 'left'],
              },
            },
            {
              name: 'preventOverflow',
              options: {
                mainAxis: false,
                altAxis: false
              }
            }
            ]        
          }      
        };
        window.tippy(annoteTarget, config); 
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




<script src="site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>